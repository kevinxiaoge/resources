<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>day43-cookie&amp;session.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); white-space: nowrap; background-color: rgb(247, 247, 247); }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; z-index: 1; background: rgb(119, 238, 119); }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: black; }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.CodeMirror-activeline-background { background: rgb(232, 242, 255); }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background: transparent; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; color: rgb(51, 51, 51); overflow-x: hidden; background-color: rgb(255, 255, 255); }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: rgb(181, 214, 252); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences, pre.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: pre; position: relative !important; background: inherit; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number pre.md-fences { padding-left: 0px; }
.show-fences-line-number pre.md-fences.mock-cm { padding-left: 40px; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background: transparent; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { page-break-after: avoid; orphans: 2; }
  p { orphans: 4; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
#write pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; display: block; background: rgb(204, 204, 204); }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
.md-toc-h6 { margin-left: 12em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 8em; }
  .md-toc-h6 { margin-left: 9.5em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; text-decoration: initial !important; text-shadow: initial !important; background: transparent !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: normal; src: local(Open Sans Regular), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: normal; src: local(Open Sans Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400i.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: bold; src: local(Open Sans Bold), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: bold; src: local(Open Sans Bold Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700i.woff) format(woff); }
html { font-size: 16px; }
body { font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; -webkit-font-smoothing: antialiased; }
#write { max-width: 800px; margin: 0px auto; padding: 20px 30px 40px; }
#write::after { height: 80px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; -webkit-font-smoothing: antialiased; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); background-color: rgb(231, 231, 231); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); margin: 0px; padding: 0px; background-color: white; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); }
pre.md-fences, .md-fences, code, tt { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; background-color: rgb(248, 248, 248); }
pre.md-fences, .md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  table, pre { page-break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; background-color: rgb(247, 247, 247); }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; background-color: rgb(248, 248, 248); }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; background-color: rgb(250, 250, 250); }


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-c1' class='md-header-anchor '></a>Cookie和Session</h1><h1><a name='header-c6' class='md-header-anchor '></a>学习目标</h1><p>1.能够说出会话的概念(了解)</p><p>2.能够说出cookie的概念(了解)</p><p>3.能够创建、发送、接收、删除cookie(掌握)</p><p>4.能够说出cookie执行原理(了解)</p><p>5.能够说出jsp的优势(了解)</p><p>6.能够编写jsp代码片段、声明、脚本表达式(掌握)</p><p>7.能够说出session的概念(了解)</p><p>8.能够获取session对象、添加、删除、获取session中的数据(掌握)</p><p>9.能够完成登录验证码案例(掌握)</p><h1><a name='header-c25' class='md-header-anchor '></a>第1章会话的基本概念</h1><h2><a name='header-c26' class='md-header-anchor '></a>1.1 什么是会话</h2><p>在日常生活中，从拨通电话到挂断电话之间的一连串的你问我答的过程就是一个会话。Web应用中的会话过程类似于生活中的打电话过程，它指的是一个客户端（浏览器）与Web服务器之间连续发生的一系列请求和响应过程，例如，一个用户在某网站上的整个购物过程就是一个会话。</p><p>在打电话过程中，通话双方会有通话内容，同样，在客户端与服务器端交互的过程中，也会产生一些数据。例如，用户甲和乙分别登录了购物网站，甲购买了一个Nokia手机，乙购买了一个Ipad，当这两个用户结账时，Web服务器需要对用户甲和乙的信息分别进行保存。在前面章节讲解的域对象中，HttpServletRequest对象和ServletContext对象都可以对数据进行保存，但是这两个对象都不可行，具体原因如下：</p><p>（1）客户端请求Web服务器时，针对每次HTTP请求，Web服务器都会创建一个HttpServletRequest对象，该对象只能保存本次请求所传递的数据。由于购买和结账是两个不同的请求，因此，在发送结账请求时，之前购买请求中的数据将会丢失。</p><p>（2）使用ServletContext对象保存数据时，由于同一个Web应用共享的是同一个ServletContext对象，因此，当用户在发送结账请求时，由于无法区分哪些商品是哪个用户所购买的，而会将该购物网站中所有用户购买的商品进行结算，这显然也是不可行的。</p><p>（3）为了保存会话过程中产生的数据，在Servlet技术中，提供了两个用于保存会话数据的对象，分别是Cookie和Session。关于Cookie和Session的相关知识，将在下面的小节进行详细讲解。</p><p><img src='img/temp8.png' alt='' /></p><p>Servlet的会话技术主要有<strong>cookie</strong>与<strong>session</strong>两种  。</p><p></p><p></p><h1><a name='header-c45' class='md-header-anchor '></a>第2章 cookie</h1><h2><a name='header-c46' class='md-header-anchor '></a>2.1 cookie的概念</h2><h3><a name='header-c47' class='md-header-anchor '></a>2.1.1 什么是cookie</h3><p>​	cookie就是服务器存放在浏览器(客户端)的一小份数据(只能是字符串，并且不超过4kb)，以后浏览器(客户端)每次访问这个服务器都会将cookie携带过来。</p><p>​	cookie实际上就可以看成一门客户端缓存技术。</p><p></p><h2><a name='header-c54' class='md-header-anchor '></a>2.2 cookie的应用场景(一般用来存放一些简单的配置信息)</h2><ol><li><p>记住用户名</p><p><img src='img\01.png' alt='' /></p></li><li><p>自动登录（记住用户名和密码）</p><p><img src='img\02.png' alt='' /></p></li></ol><p>3.保存电影的播放进度。</p><h2><a name='header-c68' class='md-header-anchor '></a>2.3 cookie的基本使用</h2><h3><a name='header-c69' class='md-header-anchor '></a>2.3.1 cookie常用的方法介绍</h3><h4><a name='header-c70' class='md-header-anchor '></a>2.3.1.1 API介绍</h4><ol><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure">AخA</div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Cookie</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">Cookie</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">value</span>)  <span class="cm-variable">创建cookie对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-3">String</span> <span class="cm-def">getName</span>() &nbsp; <span class="cm-variable">获取cookie的名称</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-3">String</span> <span class="cm-def">getValue</span>()  <span class="cm-variable">获取cookie的值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-3">void</span> <span class="cm-def">setPath</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">uri</span>) &nbsp; <span class="cm-variable">设置cookie的路径——浏览器根据这个路径判断那些cookie要发送给服务器</span></span></pre></div></div></div></div></div></div></div></pre></li><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HttpServletResponse：</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span><span class="cm-variable-3">void</span> <span class="cm-def">addCookie</span>(<span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span>) &nbsp; <span class="cm-variable">将cookie发送给浏览器</span></span></pre></div></div></div></div></div></div></div></pre></li><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HttpServletRequest：</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span><span class="cm-variable">Cookie</span>[] <span class="cm-def">getCookies</span>()  <span class="cm-variable">获取浏览器发送的cookie</span></span></pre></div></div></div></div></div></div></div></pre></li></ol><h4><a name='header-c78' class='md-header-anchor '></a>2.3.1.2 使用步骤</h4><ol><li>在CookieServlet1创建cookie</li><li>在CookieServlet1设置cookie路径为当前项目根路径：“/day04”</li><li>在CookieServlet1使用response对象将cookie发送给浏览器</li><li>在CookieServlet2通过request对象获取浏览器发送的cookie</li><li>打印在控制台上</li></ol><p></p><h4><a name='header-c97' class='md-header-anchor '></a>2.3.1.3 演示代码</h4><p>CookieServlet1：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"CookieServlet1"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/cookie1"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CookieServlet1</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//创建cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"username"</span>,<span class="cm-string">"tom"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//设置cookie的路径——浏览器根据这个路径判断那些cookie要发送给服务器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">cookie</span>.<span class="cm-variable">setPath</span>(<span class="cm-string">"/day04"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//将cookie发送给浏览器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><p>CookieServlet2：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"CookieServlet2"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/cookie2"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CookieServlet2</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//获取浏览器发送的cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>){</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">for</span> (<span class="cm-variable">Cookie</span> <span class="cm-variable">coo</span> : <span class="cm-variable">cookies</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-string">"username"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">coo</span>.<span class="cm-variable">getName</span>())){</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//打印cookie的名称和值</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">coo</span>.<span class="cm-variable">getName</span>()<span class="cm-operator">+</span><span class="cm-string">":"</span><span class="cm-operator">+</span><span class="cm-variable">coo</span>.<span class="cm-variable">getValue</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><p></p><h4><a name='header-c110' class='md-header-anchor '></a>2.3.1.4 cookie技术原理分析</h4><p><img src='img\03.png' alt='' /></p><p></p><h3><a name='header-c115' class='md-header-anchor '></a>2.3.2 删除cookie</h3><h4><a name='header-c116' class='md-header-anchor '></a>2.3.2.1 API介绍</h4><ol><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">setMaxAge</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">expiry</span>)  <span class="cm-variable">设置cookie的最大生存时间（单位：秒）</span></span></pre></div></div></div></div></div></div></div></pre></li><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">setPath</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">uri</span>) &nbsp; <span class="cm-variable">设置cookie的路径——浏览器根据这个路径判断那些cookie要发送给服务器</span></span></pre></div></div></div></div></div></div></div></pre></li></ol><h4><a name='header-c122' class='md-header-anchor '></a>2.3.2.2 使用步骤</h4><ol><li>创建cookie对象</li><li>设置生存时间</li><li>设置cookie的路径</li><li>发送cookie给浏览器</li></ol><h4><a name='header-c136' class='md-header-anchor '></a>2.3.2.3 注意事项</h4><ol><li>cookie的生存时间单位为：秒</li><li>要删除已经存在的cookie，后一个用来覆盖cookie必须名称与路径与原来的cookie一致</li></ol><h4><a name='header-c145' class='md-header-anchor '></a>2.3.2.4 演示代码</h4><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"MaxAgeServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/maxage"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">MaxAgeServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//创建cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* Cookie cookie = new Cookie("name","tom");</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//设置cookie的生存时间</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">cookie.setMaxAge(60*60*24*7);</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//设置cookie的路径</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">cookie.setPath("/day04");</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//发送cookie给浏览器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">response.addCookie(cookie);*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//=====如果需要立刻删除cookie======</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//创建空数据的cookie，名称保持一致</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"name"</span>,<span class="cm-string">""</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//设置cookie的生存时间为0立刻死亡</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">0</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//设置cookie的路径,与原来的cookie路径保持一致</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">cookie</span>.<span class="cm-variable">setPath</span>(<span class="cm-string">"/day04"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//发送cookie给浏览器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><h3><a name='header-c149' class='md-header-anchor '></a>2.3.3 案例：记录用户上一次访问时间</h3><h4><a name='header-c150' class='md-header-anchor '></a>2.3.3.1 案例需求</h4><p>​	展示用户上一次访问服务器的时间</p><h4><a name='header-c153' class='md-header-anchor '></a>2.3.3.2 案例效果</h4><p>​	展示用户上一次访问服务器的时间	</p><h4><a name='header-c156' class='md-header-anchor '></a>2.3.3.3 案例分析</h4><p><img src='img\04.png' alt='' /></p><h4><a name='header-c159' class='md-header-anchor '></a>2.3.3.4 实现代码</h4><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">text</span>.<span class="cm-variable">SimpleDateFormat</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Date</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"TimeServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/time"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TimeServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//第一次访问操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 1 获取用户当前访问的时间</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Date</span> <span class="cm-variable">date</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-comment">//格式化时间数据(注意：在cookie值中不能使用分号（;）、逗号（,）、等号（=）以及空格，否则会出现异常)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">SimpleDateFormat</span> <span class="cm-variable">format</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>(<span class="cm-string">"yyyy-MM-dd/hh:mm:ss"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable-3">String</span> <span class="cm-variable">format1</span> <span class="cm-operator">=</span> <span class="cm-variable">format</span>.<span class="cm-variable">format</span>(<span class="cm-variable">date</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">format1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 2 将数据存入cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"time"</span>, <span class="cm-variable">format1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">60</span><span class="cm-operator">*</span><span class="cm-number">60</span><span class="cm-operator">*</span><span class="cm-number">24</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 3 将数据发送给浏览器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//第二次访问操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-comment">//获取cookie数组</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-variable">Cookie</span> <span class="cm-variable">cookie2</span> : <span class="cm-variable">cookies</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//选择获取名称为time的cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-string">"time"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">cookie2</span>.<span class="cm-variable">getName</span>())) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//将数据发送页面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-variable">cookie2</span>.<span class="cm-variable">getValue</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><h4><a name='header-c163' class='md-header-anchor '></a>2.3.3.5 注意事项</h4><p>​	在<strong>上面的案例中我们给cookie添加数据的时候需要注意数据的内容，上面提到的——在cookie值中不能使用分号（;）、逗号（,）、等号（=）以及空格。</strong></p><p>如果存入的数据不合法，会出现一个错误：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">java</span>.<span class="cm-variable">lang</span>.<span class="cm-variable">IllegalArgumentException</span>: </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-variable">An</span> <span class="cm-variable">invalid</span> <span class="cm-variable">character</span> [<span class="cm-number">32</span>] <span class="cm-variable">was</span> <span class="cm-variable">present</span> <span class="cm-variable">in</span> <span class="cm-variable">the</span> <span class="cm-variable">Cookie</span> <span class="cm-variable">value</span></span></pre></div></div></div></div></div></div></div></pre><p></p><p>​	<strong>那么如果我们一定要保存非法数据在cookie中，该如何操作呢？</strong></p><p>​	<strong>答：cookie对于基本符号、数字、和字母是可以存储的，因此，我们只需要将非法数据转换成符号、数字、和字母形式存储，要使用的时候再转换成正常的中文（解码）即可。</strong></p><p>​	那么，最后的问题就是，我们如何对中文数据进行编码和解码呢？我们需要来学习一些新的对象和方法。</p><h5><a name='header-c177' class='md-header-anchor '></a>2.3.3.5.1 API介绍</h5><ol><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">URLEncoder类：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">static</span> <span class="cm-variable-3">String</span> <span class="cm-def">encode</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">s</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">enc</span>)  <span class="cm-variable">将指定的字符串，按指定的编码表编码</span></span></pre></div></div></div></div></div></div></div></pre></li><li><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">URLDecoder类：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">static</span> <span class="cm-variable-3">String</span> <span class="cm-def">decode</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">s</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">enc</span>)  <span class="cm-variable">将指定的字符串，按指定的编码表解码</span></span></pre></div></div></div></div></div></div></div></pre><p>​</p></li></ol><h5><a name='header-c185' class='md-header-anchor '></a>2.3.3.5.2 使用步骤</h5><ol><li>在创建cookie之前将数据编码</li><li>将编码后的数据存入cookie</li><li>获取到cookie之后，解码数据，获取正常中文内容</li></ol><h5><a name='header-c196' class='md-header-anchor '></a>2.3.3.5.3 注意事项</h5><ol><li>编码解码两次操作要使用同一个编码表</li></ol><h5><a name='header-c201' class='md-header-anchor '></a>2.3.3.5.4 演示代码</h5><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">net</span>.<span class="cm-variable">URLDecoder</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">net</span>.<span class="cm-variable">URLEncoder</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">text</span>.<span class="cm-variable">SimpleDateFormat</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Date</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"TimeServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/time"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TimeServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//第一次访问操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 1 获取用户当前访问的时间</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Date</span> <span class="cm-variable">date</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 2 格式化时间数据(时间转换成含有非法字符形式)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">SimpleDateFormat</span> <span class="cm-variable">format</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>(<span class="cm-string">"yyyy年MM月dd日 ;,= hh时mm分ss秒"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable-3">String</span> <span class="cm-variable">format1</span> <span class="cm-operator">=</span> <span class="cm-variable">format</span>.<span class="cm-variable">format</span>(<span class="cm-variable">date</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">format1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 3 将数据进行编码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">encode</span> <span class="cm-operator">=</span> <span class="cm-variable">URLEncoder</span>.<span class="cm-variable">encode</span>(<span class="cm-variable">format1</span>, <span class="cm-string">"utf-8"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 4 将数据存入cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"time"</span>,<span class="cm-variable">encode</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">60</span><span class="cm-operator">*</span><span class="cm-number">60</span><span class="cm-operator">*</span><span class="cm-number">24</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">// 5 将数据发送给浏览器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//第二次访问操作</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-comment">//获取cookie数组</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span> <span class="cm-variable">Cookie</span>[] <span class="cm-variable">cookies</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getCookies</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">cookies</span> <span class="cm-operator">!=</span> <span class="cm-atom">null</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-variable">Cookie</span> <span class="cm-variable">cookie2</span> : <span class="cm-variable">cookies</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//选择获取名称为time的cookie</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-string">"time"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">cookie2</span>.<span class="cm-variable">getName</span>())) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//由于数据之前经过编码，现在要还原的中文数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">decode</span> <span class="cm-operator">=</span> <span class="cm-variable">URLDecoder</span>.<span class="cm-variable">decode</span>(<span class="cm-variable">cookie2</span>.<span class="cm-variable">getValue</span>(), <span class="cm-string">"utf-8"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//将数据发送页面</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=utf-8"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-variable">decode</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><h3><a name='header-c205' class='md-header-anchor '></a>2.4封装CookieUtil工具类</h3><pre class='md-fences mock-cm' style='display:block;position:relative'>public class CookieUtil {
	/**
	 * 创建并配置Cookie
	 * @param name  cookie的name
	 * @param value  cookie的value
	 * @param time  有效期，秒
	 * @param path  有效范围
	 * @return
	 */
	public static Cookie createCookie(String name,String value,int time,String path){
		Cookie cookie = new Cookie(name, value);
		//Cookie的一些其他设置，可以设置最大有效期，可以设置有效范围(在哪里能够获取到该Cookie信息)
		//设置有效期
		cookie.setMaxAge(time);
		//设置有效范围
		cookie.setPath(path);//只能在CookieDemo02这个Servlet中获取该Cookie的信息
		return cookie;
	}
	public static String getCookieValue(HttpServletRequest request,String cookieName){
		Cookie[] cookies = request.getCookies();
		String value = null;
		if (cookies != null) {
			for (Cookie cookie : cookies) {
				if (cookieName.equals(cookie.getName())) {
					//确实是咱们要获取的那个名为username的cookie对象
					value = cookie.getValue();
				}
			}
		}
		return value;
	}
}</pre><p></p><h1><a name='header-c209' class='md-header-anchor '></a>第3章 jsp的基本入门</h1><h2><a name='header-c210' class='md-header-anchor '></a>3.1 jsp简介</h2><h3><a name='header-c211' class='md-header-anchor '></a>3.1.1 jsp的概念</h3><p>HTML代码与Java代码共同存在，其中，HTML代码用来实现网页中静态内容的显示，Java代码用来实现网页中动态内容的显示。为了与传统HTML有所区别，JSP文件的扩展名为.jsp。</p><p>JSP技术所开发的Web应用程序是基于Java的，它可以用一种简捷而快速的方法从Java程序生成Web页面，其使用上具有如下几点特征：</p><p>l <strong>跨平台：</strong>由于JSP是基于Java语言的，它可以使用Java API，所以它也是跨平台的，可以应用于不同的系统中，如Windows、Linux等。当从一个平台移植到另一个平台时，JSP和JavaBean的代码并不需要重新编译，这是因为Java的字节码是与平台无关的，这也应验了Java语言“一次编译，到处运行”的特点。</p><p>l <strong>业务代码相分离：</strong>在使用JSP技术开发Web应用时，可以将界面的开发与应用程序的开发分离开。开发人员使用HTML来设计界面，使用JSP标签和脚本来动态生成页面上的内容。在服务器端，JSP引擎（或容器，本书中指Tomcat）负责解析JSP标签和脚本程序，生成所请求的内容，并将执行结果以HTML页面的形式返回到浏览器。</p><p>l <strong>组件重用：</strong>JSP中可以使用JavaBean编写业务组件，也就是使用一个JavaBean类封装业务处理代码或者作为一个数据存储模型，在JSP页面中，甚至在整个项目中，都可以重复使用这个JavaBean，同时，JavaBean也可以应用到其他Java应用程序中。</p><p>l <strong>预编译：</strong>预编译就是在用户第一次通过浏览器访问JSP页面时，服务器将对JSP页面代码进行编译，并且仅执行一次编译。编译好的代码将被保存，在用户下一次访问时，会直接执行编译好的代码。这样不仅节约了服务器的CPU资源，还大大的提升了客户端的访问速度。</p><p></p><h3><a name='header-c226' class='md-header-anchor '></a>3.1.2 为什么要诞生JSP</h3><p>​	我们先来设计一个场景，完成一个需求：准备一个页面，根据页面的上链接的请求，展示不同古代美女的名称。</p><h4><a name='header-c229' class='md-header-anchor '></a>3.1.2.1 准备页面</h4><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;meta</span> <span class="cm-attribute">http-equiv</span>=<span class="cm-string">"Content-Type"</span> <span class="cm-attribute">content</span>=<span class="cm-string">"text/html; charset=UTF-8"</span><span class="cm-tag">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;title&gt;</span>Insert title here<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">&lt;!-- 需求：根据不同请求参数，显示不同古代美女名称 --&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/day04/test?param=1"</span><span class="cm-tag">&gt;</span>美女1<span class="cm-tag">&lt;/a&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/day04/test?param=2"</span><span class="cm-tag">&gt;</span>美女2<span class="cm-tag">&lt;/a&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"/day04/test?param=3"</span><span class="cm-tag">&gt;</span>美女3<span class="cm-tag">&lt;/a&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><h4><a name='header-c231' class='md-header-anchor '></a>3.1.2.2 演示servlet</h4><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"TestServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/test"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">TestServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">parameter</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"param"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//处理响应的乱码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">setContentType</span>(<span class="cm-string">"text/html;charset=utf-8"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-string">"1"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">parameter</span>)) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"&lt;h1&gt;&lt;font color='red'&gt;西施&lt;/font&gt;&lt;/h1&gt;"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}<span class="cm-keyword">else</span> <span class="cm-keyword">if</span>(<span class="cm-string">"2"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">parameter</span>)) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"&lt;h1&gt;&lt;font color='red'&gt;貂蝉&lt;/font&gt;&lt;/h1&gt;"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}<span class="cm-keyword">else</span> <span class="cm-keyword">if</span>(<span class="cm-string">"3"</span>.<span class="cm-variable">equals</span>(<span class="cm-variable">parameter</span>)) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"&lt;h1&gt;&lt;font color='red'&gt;王昭君&lt;/font&gt;&lt;/h1&gt;"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}<span class="cm-keyword">else</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">getWriter</span>().<span class="cm-variable">write</span>(<span class="cm-string">"参数不合法"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>​	<strong>通过书写servlet代码，我们发现一个问题：</strong> 
 		<strong>使用response对象，向页面输出内容，需要拼接html标签，这个操作十分麻烦。</strong></p><p>​	因此我们需要一个解决方案，那么这个解决方案应该满足什么条件呢？</p><p>​		<strong>应该有以下两点：</strong></p><p>​			<strong>1 必须不再拼接html，使用字符串向页面输出代码</strong></p><p>​			<strong>2 需要保留servlet可以通过代码，动态生成网页的功能</strong></p><p>​	<strong>满足这两点的正式我们要学习的JSP技术：它可以简化html书写，同时动态生成页面。</strong></p><p></p><h3><a name='header-c248' class='md-header-anchor '></a>3.1.3 体验jsp</h3><h4><a name='header-c249' class='md-header-anchor '></a>3.1.3.1 创建JSP文件</h4><p><img src='img\05.png' alt='' /></p><p></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tag">&lt;title&gt;</span>测试jsp<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-operator">&lt;%</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">Date</span> <span class="cm-variable">date</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Date</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">SimpleDateFormat</span> <span class="cm-variable">dateFormat</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SimpleDateFormat</span>(<span class="cm-string">"yyyy-MM-dd HH:mm:dd"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable-3">String</span> <span class="cm-variable">curTime</span> <span class="cm-operator">=</span> <span class="cm-variable">dateFormat</span>.<span class="cm-variable">format</span>(<span class="cm-variable">date</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">request</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"curTime"</span>,<span class="cm-variable">curTime</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  当前系统时间：<span class="cm-tag">&lt;span</span> <span class="cm-attribute">style</span>=<span class="cm-string">"color: red"</span><span class="cm-tag">&gt;</span><span class="cm-operator">&lt;%=</span><span class="cm-variable">request</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"curTime"</span>) %&gt;<span class="cm-tag">&lt;/span&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p>在地址栏输入jsp文件名称访问即可。</p><p>效果：</p><p><img src='img\temp6.png' alt='temp6' /></p><h2><a name='header-c261' class='md-header-anchor '></a>3.2 jsp的执行原理</h2><p>通过上述的体验jsp之后，我们发现jsp真的非常厉害，既可以编写java代码也可以直接编写html代码，相对servlet更加方便，那么<strong>jsp为什么可以直接使用reqeust 与直接编写html代码呢</strong></p><p><img src='img\06.png' alt='' /></p><p></p><p>依据上图的流程，C:\Users\ztl.IntelliJIdea2017.3\system\tomcat\Unnamed_javase\work\Catalina\localhost\webtest\org\apache\jsp找到了生成的java文件，其中一部分内容如下图：</p><p><img src='img\17.png' alt='' /></p><p>​	我们可以看到当前的jsp文件被翻译成了一个类，这个类继承HttpJspBase类，那么这个HttpJspBase类又是什么？</p><p>​	注意jsp的翻译有服务器完成，HttpJspBase类一定也是tomcat服务器的内容，顺着org.apache.jasper.runtime.HttpJspBase这个类全名，我们找到这个类的源码：</p><p><img src='img\18.png' alt='' /></p><p>​	通过观察源码，<strong>我们发现JSP其实底层就是一个servlet</strong>。通过观察源码，我们发现我们刚刚编写的所有代码都在该Servlet里面的service方法内部。</p><p><img src='img\temp7.png' alt='temp7' /></p><p><strong>总结：</strong></p><p>​	<strong>1.</strong> jsp之所以可以编写html代码，其实本质上也是类似我们使用Servlet直接输出的。</p><p>​	<strong>2.</strong>jsp之所以直接使用 直接使用request对象，是因为我们自己编写的代码全部都落入到了service方法内部，在service方法内部一开始就已经声明了request等对象了。</p><h2><a name='header-c289' class='md-header-anchor '></a>3.3 jsp的基本语法</h2><h3><a name='header-c290' class='md-header-anchor '></a>3.3.1 jsp注释</h3><h4><a name='header-c291' class='md-header-anchor '></a>3.3.1.1 JSP注释格式</h4><p>​		&lt;%-- jsp注释  --%&gt;</p><h4><a name='header-c294' class='md-header-anchor '></a>3.3.1.2 JSP注释的使用</h4><p><strong>jsp文件</strong>：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;%</span><span class="cm-meta">@</span> <span class="cm-variable">page</span> <span class="cm-variable">contentType</span><span class="cm-operator">=</span><span class="cm-string">"text/html;charset=UTF-8"</span> <span class="cm-variable">language</span><span class="cm-operator">=</span><span class="cm-string">"java"</span> <span class="cm-operator">%&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;</span><span class="cm-variable">html</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;</span><span class="cm-variable">head</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;</span><span class="cm-variable">title</span><span class="cm-operator">&gt;</span><span class="cm-variable">注释</span><span class="cm-operator">&lt;/</span><span class="cm-variable">title</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;/</span><span class="cm-variable">head</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;</span><span class="cm-variable">body</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">&lt;!---</span><span class="cm-variable">这个是html注释</span><span class="cm-operator">--&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">&lt;%--</span> <span class="cm-variable">这个是jsp的注释</span><span class="cm-operator">--%&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;/</span><span class="cm-variable">body</span><span class="cm-operator">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;/</span><span class="cm-variable">html</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p></p><p>访问页面测试：没有任何内容显示，那么也就说html与jsp注释都生效, 但是点击查看源码的时候我们发现我们只能查看到html的注释，jsp的注释根本就看不到。 </p><p><img src='img\07.png' alt='' /></p><p><img src='img\temp5.png' alt='temp5' /></p><p><strong>总结</strong></p><p>​	<strong>1.</strong> jsp的注释不会显示在源码上，更加安全。</p><p>​	<strong>2.</strong> 如果在jstl标签体内使用html的注释将会失效，所以在jsp页面中推荐使用jsp的注释。</p><p></p><h3><a name='header-c314' class='md-header-anchor '></a>3.3.2 jsp书写java代码的三种方式</h3><p>​	在之前的演示中，我的jsp已经可以向页面输出一个html内容，但是这个还不够，jsp应该还要有像servlet一样可以通过代码，动态生成网页的功能。servlet是使用java代码生成动态网页的，因此，接下来，我们要学习如何在jsp页面使用java代码。</p><p></p><h4><a name='header-c319' class='md-header-anchor '></a>3.3.2.1 脚本片段</h4><h5><a name='header-c320' class='md-header-anchor '></a>3.3.2.1.1  脚本片段格式</h5><p>​	格式：&lt;%  Java代码片段  %&gt;</p><p>​	实际上是运行在翻译成的Java类中的Service方法中</p><p>​	jsp文件内容：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;%</span><span class="cm-meta">@</span> <span class="cm-variable">page</span> <span class="cm-variable">contentType</span><span class="cm-operator">=</span><span class="cm-string">"text/html;charset=UTF-8"</span> <span class="cm-variable">language</span><span class="cm-operator">=</span><span class="cm-string">"java"</span> %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;title&gt;</span>书写java代码的三种方式<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;%--</span> <span class="cm-variable">脚本片段</span> <span class="cm-operator">--%&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;%</span> <span class="cm-variable-3">int</span> <span class="cm-variable">x</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>; %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p>​	翻译成java文件：	</p><p><img src='img\11.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>	总结:在脚本片段中书写的Java代码，会翻译到java文件中的_jspService方法中。</pre><p></p><h5><a name='header-c335' class='md-header-anchor '></a>3.3.2.1.2 脚本片段作用</h5><pre class='md-fences mock-cm' style='display:block;position:relative'>	在jsp翻译后的_jspService方法中，嵌入java代码</pre><h5><a name='header-c337' class='md-header-anchor '></a>3.3.2.1.3 脚本片段使用注意事项</h5><p>​	脚本片段可以分开书写，最终是组合在一起的，示例：</p><p>​	脚本片段内容：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;%</span> <span class="cm-keyword">for</span>(<span class="cm-variable-3">int</span> <span class="cm-variable">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> ; <span class="cm-variable">j</span> <span class="cm-operator">&lt;</span> <span class="cm-number">5</span> ;<span class="cm-variable">j</span><span class="cm-operator">++</span>){%&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  Hello World!!!<span class="cm-tag">&lt;br&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">&lt;%</span>}%&gt;</span></pre></div></div></div></div></div></div></div></pre><p>​	效果：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Hello</span> <span class="cm-variable">World</span><span class="cm-operator">!!!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Hello</span> <span class="cm-variable">World</span><span class="cm-operator">!!!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Hello</span> <span class="cm-variable">World</span><span class="cm-operator">!!!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Hello</span> <span class="cm-variable">World</span><span class="cm-operator">!!!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Hello</span> <span class="cm-variable">World</span><span class="cm-operator">!!!</span></span></pre></div></div></div></div></div></div></div></pre><p>​	java源码:</p><p><img src='img\19.png' alt='' /></p><p></p><p></p><h4><a name='header-c354' class='md-header-anchor '></a>3.3.2.2 脚本声明</h4><p>​	脚本片段虽然可以嵌入java代码，但是如果，我们要给当前的jsp中定义一些方法或者成员变量，就行需要一个新的技术——脚本声明。</p><h5><a name='header-c357' class='md-header-anchor '></a>3.3.2.2.1 脚本声明格式</h5><p>​	格式：&lt;%!  书写Java代码  %&gt;</p><p>​	jsp文件内容：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;%</span><span class="cm-meta">@</span> <span class="cm-variable">page</span> <span class="cm-variable">contentType</span><span class="cm-operator">=</span><span class="cm-string">"text/html;charset=UTF-8"</span> <span class="cm-variable">language</span><span class="cm-operator">=</span><span class="cm-string">"java"</span> %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;title&gt;</span>书写java代码的三种方式<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;%!</span> <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span> ;%&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p>​	翻译成java文件：	</p><p><img src='img\08.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>总结：脚本声明书写的java代码会翻译在类的成员位置上。</pre><p></p><h5><a name='header-c370' class='md-header-anchor '></a>3.3.2.2.2 脚本声明作用</h5><pre class='md-fences mock-cm' style='display:block;position:relative'>在类的成员位置上声明方法和变量</pre><p></p><h5><a name='header-c374' class='md-header-anchor '></a>3.3.2.2.3 脚本声明使用注意事项</h5><pre class='md-fences mock-cm' style='display:block;position:relative'>声明方法的时候，不要声明与jsp翻译的java文件中默认的一些方法或者变量同名的方法或者变量。</pre><p></p><h4><a name='header-c378' class='md-header-anchor '></a>3.3.2.3 脚本表达式</h4><p>​	虽然脚本声明和脚本片段已经可以书写Java代码了，但是如果我们要使用java代码向页面输出一些内容，还是需要使用原来的response对象，比较繁琐，因此，我们需要一个更加简便的方式，可以代替response向页面输出内容——这个就是脚本表达式。</p><h5><a name='header-c381' class='md-header-anchor '></a>3.3.2.3.1 脚本表达式格式</h5><p>​	格式：&lt;%= 表达式 %&gt;</p><p>​	jsp文件内容：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">&lt;%</span><span class="cm-meta">@</span> <span class="cm-variable">page</span> <span class="cm-variable">contentType</span><span class="cm-operator">=</span><span class="cm-string">"text/html;charset=UTF-8"</span> <span class="cm-variable">language</span><span class="cm-operator">=</span><span class="cm-string">"java"</span> %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;title&gt;</span>书写java代码的三种方式<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;%--</span> <span class="cm-variable">脚本表达式</span> <span class="cm-operator">--%&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">&lt;%=</span> <span class="cm-string">"传智播客"</span> %&gt;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p>​	翻译成java文件：在_jspService方法中，找到了我们书写的内容</p><p><img src='img\09.png' alt='' /></p><p>​	上图的中的out对象是什么？</p><p>​	答：out对象的类型是JspWriter，通过查阅JAVAEE文档发现其父类是java.io.Writer，是一个Writer 字符流。</p><p>​	页面输出：</p><p>​	</p><p><img src='img\10.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>	总结：脚本表达式书写的java代码，会翻译到java文件中的_jspService方法内，被out.print输出到页面。</pre><h5><a name='header-c402' class='md-header-anchor '></a>3.3.2.3.2 脚本表达式作用</h5><pre class='md-fences mock-cm' style='display:block;position:relative'>	代替response向页面输出内容</pre><h5><a name='header-c404' class='md-header-anchor '></a>3.3.2.3.3 脚本表达式使用注意事项</h5><pre class='md-fences mock-cm' style='display:block;position:relative'>	使用表达式向页面输出内容的时候，不要同时使用response对象向页面输出内容，会出现页面内容输出顺序和代码顺序不一致。</pre><p></p><p></p><h1><a name='header-c410' class='md-header-anchor '></a>第4章 session(就是我们要学习的第三个域对象)</h1><h2><a name='header-c411' class='md-header-anchor '></a>4.1 session的基本概念</h2><p></p><p>当人们去医院就诊时，就诊病人需要办理医院的就诊卡，该卡上只有卡号，而没有其它信息。但病人每次去该医院就诊时，只要出示就诊卡，医务人员便可根据卡号查询到病人的就诊信息。Session技术就好比医院发放给病人的就医卡和医院为每个病人保留病例档案的过程。当浏览器访问Web服务器时，Servlet容器就会创建一个Session对象和ID属性，其中，Session对象就相当于病历档案，ID就相当于就诊卡号。当客户端后续访问服务器时，只要将标识号传递给服务器，服务器就能判断出该请求是哪个客户端发送的，从而选择与之对应的Session对象为其服务。</p><p>需要注意的是，由于客户端需要接收、记录和回送Session对象的ID，因此，通常情况下，Session是借助Cookie技术来传递ID属性的。</p><p>为了使读者更好的理解Session，接下来，以网站购物为例，通过一张图来描述Session保存用户信息的原理，具体如图5-5所示。</p><p></p><p><img src='img/temp1.png' alt='' /></p><p></p><p>​                                                           图1-1         Session保存用户信息的过程</p><p>在图5-5中，用户甲和乙都调用buyServlet将商品添加到购物车，调用payServlet进行商品结算。由于甲和乙购买商品的过程类似，在此，以用户甲为例进行详细说明。当用户甲访问购物网站时，服务器为甲创建了一个Session对象（相当于购物车）。当甲将Nokia手机添加到购物车时，Nokia手机的信息便存放到了Session对象中。同时，服务器将Session对象的ID属性以Cookie (Set-Cookie: JSESSIONID=111)的形式返回给甲的浏览器。当甲完成购物进行结账时，需要向服务器发送结账请求，这时，浏览器自动在请求消息头中将Cookie (Cookie: JSESSIONID=111)信息回送给服务器，服务器根据ID属性找到为用户甲所创建的Session对象，并将Session对象中所存放的Nokia手机信息取出进行结算。 </p><p></p><h3><a name='header-c432' class='md-header-anchor '></a>4.1.1 什么要存在Session</h3><p>l  使用servlet生成验证码时，我们需要在服务器记录一份生成的随机字符，当用户提交填写的数据时，将用户输入的数据和服务器缓存的数据进行比对。</p><p>l  将随机字符串保存在ServletContext中或者request中是否可以?</p><p>n  将数据存放到ServletContext，多个用户共享一个验证码。</p><p><img src='img\temp2.png' alt='' /></p><p></p><p>n  将数据存放到request作用域，多次请求不能共享数据。</p><p><img src='img\temp3.png' alt='' /></p><p> 我们发现将数据保存到ServletContext和request中是存在问题的，那么就需要使用会话技术保存用户的私有信息.</p><p>​	</p><h2><a name='header-c451' class='md-header-anchor '></a>4.2 session的与cookie的区别</h2><table><thead><tr><th></th><th style='text-align:center;' >cookie</th><th style='text-align:right;' >session</th></tr></thead><tbody><tr><td>会话数据保存的位置</td><td style='text-align:center;' >浏览器</td><td style='text-align:right;' >服务器</td></tr><tr><td>数据的安全性</td><td style='text-align:center;' >不安全</td><td style='text-align:right;' >安全</td></tr><tr><td>存储数是否有限制</td><td style='text-align:center;' >有</td><td style='text-align:right;' >无</td></tr></tbody></table><h2><a name='header-c469' class='md-header-anchor '></a>4.3 session的应用场景</h2><ol><li>保存购物车数据(一般也使用数据库)</li><li>保存用户浏览器记录数据(一般使用数据库)</li><li>保存用户登录信息数据(很重要，也就是说登录成功之后用户信息要保存在session中)</li><li>保存验证码(也很常见)</li></ol><h2><a name='header-c483' class='md-header-anchor '></a>4.4 session的基本使用</h2><h3><a name='header-c484' class='md-header-anchor '></a>4.4.1 session存储数据与 获取数据</h3><h4><a name='header-c485' class='md-header-anchor '></a>4.4.1.1 API介绍</h4><ol><li><p>HttpServletRequest </p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">HttpSession</span> <span class="cm-def">getSession</span>()  <span class="cm-variable">获取session对象</span> </span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>HttpSession</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable-3">void</span> <span class="cm-def">setAttribute</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>, <span class="cm-variable-3">Object</span> <span class="cm-variable">value</span>) <span class="cm-variable">在session中保存数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable-3">Object</span> <span class="cm-def">getAttribute</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>)  <span class="cm-variable">从session中获取数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable-3">void</span> <span class="cm-def">removeAttribute</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">name</span>)  <span class="cm-variable">从session中移除数据</span></span></pre></div></div></div></div></div></div></div></pre><p>​</p></li></ol><h4><a name='header-c499' class='md-header-anchor '></a>4.4.1.2 使用步骤</h4><ol><li>在SessionServlet通过request对象获取session对象</li><li>在SessionServlet调用session的setAttribute保存数据</li><li>在SessionServlet调用session的getAttribute获取数据</li><li>在SessionServlet1通过request对象获取session对象</li><li>在SessionServlet1调用session的removeAttribute移除数据</li><li>在SessionServlet1调用session的getAttribute获取数据</li></ol><h4><a name='header-c520' class='md-header-anchor '></a>4.4.1.3 注意事项</h4><ol><li>getAttribute方法返回值是Object，因此需要将返回值强制转换才能方便使用。</li></ol><h4><a name='header-c526' class='md-header-anchor '></a>4.4.1.3 演示代码</h4><p>SessionServlet：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpSession</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"SessionServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/session"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SessionServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//获取session对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HttpSession</span> <span class="cm-variable">session</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//添加数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">session</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"addr"</span>,<span class="cm-string">"广州"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>SessionServlet1:</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpSession</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"SessionServlet1"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/session1"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SessionServlet1</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//获取session对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HttpSession</span> <span class="cm-variable">session</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-tab">  </span><span class="cm-comment">//获取数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable-3">String</span> <span class="cm-variable">addr</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">session</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"addr"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">addr</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//移除数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">session</span>.<span class="cm-variable">removeAttribute</span>(<span class="cm-string">"addr"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//再次获取，查看效果</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable-3">String</span> <span class="cm-variable">addr1</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>) <span class="cm-variable">session</span>.<span class="cm-variable">getAttribute</span>(<span class="cm-string">"addr"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">addr1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p></p><h3><a name='header-c535' class='md-header-anchor '></a>4.4.2 session的原理分析</h3><p><img src='img\14.png' alt='' /></p><p></p><h3><a name='header-c540' class='md-header-anchor '></a>4.4.3 session实现关闭浏览器继续可以访问数据</h3><p>​	通过上面的原理图，我们发现记录sessionid的cookie在关闭浏览器之后就到期了，那么如果我们希望——关闭浏览器继续可以访问session数据，该怎么做呢？</p><h4><a name='header-c543' class='md-header-anchor '></a>4.4.3.1 案例需求</h4><p>​	关闭浏览器继续可以访问session数据</p><h4><a name='header-c546' class='md-header-anchor '></a>4.4.3.2 案例效果</h4><p>​	关闭浏览器继续可以访问session数据</p><h4><a name='header-c549' class='md-header-anchor '></a>4.4.3.3 案例分析</h4><ol><li><p>创建一个servlet</p></li><li><p>通过request对象获取session的id</p></li><li><p>自定义一个cookie对象，保存session的id，注意cookie名称为&quot;JSESSIONID&quot;，设置一个比较长的生存时间</p></li><li><p>发送给浏览器</p><p>​</p></li></ol><h4><a name='header-c565' class='md-header-anchor '></a>4.4.3.4 代码实现</h4><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">Cookie</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpSession</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"SessionServlet2"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/session2"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">SessionServlet2</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//获取session对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">HttpSession</span> <span class="cm-variable">session</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">session</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//自己创建一个cookie，要求被浏览器持久化保存起来（setMaxAge(10000)）放便后期使用</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">Cookie</span> <span class="cm-variable">cookie</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Cookie</span>(<span class="cm-string">"JSESSIONID"</span>, <span class="cm-variable">session</span>.<span class="cm-variable">getId</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//活的久一点</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">cookie</span>.<span class="cm-variable">setMaxAge</span>(<span class="cm-number">10000</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">addCookie</span>(<span class="cm-variable">cookie</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>访问一次服务器，然后关闭浏览器，再访问一次：两次session对象一致</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">catalina</span>.<span class="cm-variable">session</span>.<span class="cm-variable">StandardSessionFacade</span><span class="cm-meta">@49ef5434</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">org</span>.<span class="cm-variable">apache</span>.<span class="cm-variable">catalina</span>.<span class="cm-variable">session</span>.<span class="cm-variable">StandardSessionFacade</span><span class="cm-meta">@49ef5434</span></span></pre></div></div></div></div></div></div></div></pre><p></p><p>手动调用invalidate()方法也会销毁session对象。</p><h2><a name='header-c574' class='md-header-anchor '></a>4.5 案例:使用session存储验证码完成登录功能</h2><h3><a name='header-c575' class='md-header-anchor '></a>4.5.1 案例需求</h3><ol><li><p>在登录页面用户登录的时候要查看到验证码，如图所示：</p><p><img src='img\16.png' alt='' /></p></li><li><p>在生成页面验证码图片的同时，使用session存储验证码</p></li><li><p>在处理用户登录请求的时候，首先校验验证码</p></li><li><p>校验通过才能执行登录操作</p></li></ol><h3><a name='header-c591' class='md-header-anchor '></a>3.6.2 案例效果</h3><p>​	用户提交验证码，与session中保存验证码校验一致才能登录</p><h3><a name='header-c594' class='md-header-anchor '></a>3.6.3 案例分析</h3><p><img src='img\15.png' alt='' /></p><h3><a name='header-c597' class='md-header-anchor '></a>3.6.4 代码实现</h3><ol><li><p>页面</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;%@</span> <span class="cm-attribute">page</span> <span class="cm-attribute">language</span><span class="cm-null cm-error">=</span><span class="cm-string cm-error">"java"</span> <span class="cm-attribute">import</span>=<span class="cm-string">"java.util.*"</span> <span class="cm-attribute">pageEncoding</span>=<span class="cm-string">"UTF-8"</span><span class="cm-attribute">%</span><span class="cm-tag">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;html&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;meta</span> <span class="cm-attribute">http-equiv</span>=<span class="cm-string">"Content-Type"</span> <span class="cm-attribute">content</span>=<span class="cm-string">"text/html; charset=utf-8"</span><span class="cm-tag">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;title&gt;</span>login<span class="cm-tag">&lt;/title&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;script</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text/javascript"</span><span class="cm-tag">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">function</span> <span class="cm-variable">changeCode</span>(){</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>(<span class="cm-string">"img"</span>).<span class="cm-property">src</span> = <span class="cm-string">"/day04/checkcode?r="</span>+<span class="cm-keyword">new</span> <span class="cm-variable">Date</span>().<span class="cm-property">getTime</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;/script&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/head&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;form</span> <span class="cm-attribute">action</span>=<span class="cm-string">"/day04/login"</span> <span class="cm-attribute">method</span>=<span class="cm-string">"post"</span><span class="cm-tag">&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;table&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag">&lt;tr&gt;&lt;td&gt;</span>用户名：<span class="cm-tag">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"username"</span><span class="cm-tag">&gt;&lt;/td&gt;&lt;/tr&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag">&lt;tr&gt;&lt;td&gt;</span>密码：<span class="cm-tag">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"password"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"password"</span><span class="cm-tag">&gt;&lt;/td&gt;&lt;/tr&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag">&lt;tr&gt;&lt;td&gt;</span>验证码：<span class="cm-tag">&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span class="cm-attribute">name</span>=<span class="cm-string">"code"</span><span class="cm-tag">&gt;&lt;/td&gt;&lt;/tr&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">&lt;!-- 通过向服务器发送请求，从服务器获取验证码数据 --&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag">&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;img</span> <span class="cm-attribute">id</span>=<span class="cm-string">"img"</span> <span class="cm-attribute">src</span>=<span class="cm-string">"/day04/checkcode"</span> <span class="cm-attribute">onclick</span>=<span class="cm-string">"changeCode();"</span><span class="cm-tag">/&gt;&lt;a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"javascript:;"</span> <span class="cm-attribute">onclick</span>=<span class="cm-string">"changeCode();"</span><span class="cm-tag">&gt;</span>换一换<span class="cm-tag">&lt;/a&gt;&lt;span&gt;&lt;%</span> <span class="cm-attribute">if(request.getAttribute(</span><span class="cm-string cm-error">"msg"</span><span class="cm-attribute">)!</span>=<span class="cm-string">null){out.write(request.getAttribute(</span><span class="cm-string cm-error">"msg"</span><span class="cm-attribute">).toString());}%</span><span class="cm-tag">&gt;</span><span class="cm-tag cm-error">&lt;/span&gt;&lt;/td&gt;</span><span class="cm-tag">&lt;/tr&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-tag">&lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;input</span> <span class="cm-attribute">type</span>=<span class="cm-string">"submit"</span> <span class="cm-attribute">value</span>=<span class="cm-string">"登陆"</span><span class="cm-tag">&gt;&lt;/td&gt;&lt;/tr&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tag">&lt;/table&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/form&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/body&gt;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tag">&lt;/html&gt;</span></span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>配置验证码servlet</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">awt</span>.<span class="cm-variable">Color</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">awt</span>.<span class="cm-variable">Font</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">awt</span>.<span class="cm-variable">Graphics</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">awt</span>.<span class="cm-variable">image</span>.<span class="cm-variable">BufferedImage</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">util</span>.<span class="cm-variable">Random</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">imageio</span>.<span class="cm-variable">ImageIO</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"CheckcodeServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/checkcode"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">CheckcodeServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">private</span> <span class="cm-keyword">static</span> <span class="cm-keyword">final</span> <span class="cm-variable-3">long</span> <span class="cm-variable">serialVersionUID</span> <span class="cm-operator">=</span> <span class="cm-number">1L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  创建画布</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">width</span> <span class="cm-operator">=</span> <span class="cm-number">120</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">int</span> <span class="cm-variable">height</span> <span class="cm-operator">=</span> <span class="cm-number">40</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">BufferedImage</span> <span class="cm-variable">bufferedImage</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">BufferedImage</span>(<span class="cm-variable">width</span>, <span class="cm-variable">height</span>, <span class="cm-variable">BufferedImage</span>.<span class="cm-variable">TYPE_INT_RGB</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  获得画笔</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">Graphics</span> <span class="cm-variable">g</span> <span class="cm-operator">=</span> <span class="cm-variable">bufferedImage</span>.<span class="cm-variable">getGraphics</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  填充背景颜色</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">white</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">fillRect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-variable">width</span>, <span class="cm-variable">height</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  绘制边框</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">setColor</span>(<span class="cm-variable">Color</span>.<span class="cm-variable">red</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">drawRect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-variable">width</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>, <span class="cm-variable">height</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  生成随机字符</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  准备数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">data</span> <span class="cm-operator">=</span> <span class="cm-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  准备随机对象</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">Random</span> <span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Random</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  声明一个变量 保存验证码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">code</span> <span class="cm-operator">=</span> <span class="cm-string">""</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  书写4个随机字符</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">4</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  设置字体</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">setFont</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Font</span>(<span class="cm-string">"宋体"</span>, <span class="cm-variable">Font</span>.<span class="cm-variable">BOLD</span>, <span class="cm-number">28</span>));</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  设置随机颜色</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">setColor</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Color</span>(<span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>)));</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">str</span> <span class="cm-operator">=</span> <span class="cm-variable">data</span>.<span class="cm-variable">charAt</span>(<span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">data</span>.<span class="cm-variable">length</span>())) <span class="cm-operator">+</span> <span class="cm-string">""</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">drawString</span>(<span class="cm-variable">str</span>, <span class="cm-number">10</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">28</span>, <span class="cm-number">30</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  将新的字符 保存到验证码中</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">code</span> <span class="cm-operator">=</span> <span class="cm-variable">code</span> <span class="cm-operator">+</span> <span class="cm-variable">str</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  绘制干扰线</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">for</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">6</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  设置随机颜色</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">setColor</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Color</span>(<span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-number">255</span>)));</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">g</span>.<span class="cm-variable">drawLine</span>(<span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">width</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">height</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">width</span>), <span class="cm-variable">r</span>.<span class="cm-variable">nextInt</span>(<span class="cm-variable">height</span>));</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  将验证码 打印到控制台</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">System</span>.<span class="cm-variable">out</span>.<span class="cm-variable">println</span>(<span class="cm-variable">code</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  将验证码放到session中</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">setAttribute</span>(<span class="cm-string">"code_session"</span>, <span class="cm-variable">code</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//  将画布显示在浏览器中</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">ImageIO</span>.<span class="cm-variable">write</span>(<span class="cm-variable">bufferedImage</span>, <span class="cm-string">"jpg"</span>, <span class="cm-variable">response</span>.<span class="cm-variable">getOutputStream</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">protected</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>登录servlet</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">web</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">IOException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">java</span>.<span class="cm-variable">io</span>.<span class="cm-variable">PrintWriter</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">ServletException</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">annotation</span>.<span class="cm-variable">WebServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServlet</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletRequest</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">javax</span>.<span class="cm-variable">servlet</span>.<span class="cm-variable">http</span>.<span class="cm-variable">HttpServletResponse</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">dao</span>.<span class="cm-variable">UserDao</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">dao</span>.<span class="cm-variable">impl</span>.<span class="cm-variable">UserDaoImpl</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">domain</span>.<span class="cm-variable">User</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">@WebServlet</span>(<span class="cm-variable">name</span> <span class="cm-operator">=</span> <span class="cm-string">"LoginServlet"</span>,<span class="cm-variable">urlPatterns</span> <span class="cm-operator">=</span> <span class="cm-string">"/login"</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">LoginServlet</span> <span class="cm-keyword">extends</span> <span class="cm-variable">HttpServlet</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doGet</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//用户请求中的验证码获取</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">code</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"code"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//获取session中保存的验证码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">code_session</span> <span class="cm-operator">=</span> (<span class="cm-variable-3">String</span>)<span class="cm-variable">request</span>.<span class="cm-variable">getSession</span>().<span class="cm-variable">getAttribute</span>(<span class="cm-string">"code_session"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//与session中保存的验证码进行校验</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-operator">!</span><span class="cm-variable">code_session</span>.<span class="cm-variable">equalsIgnoreCase</span>(<span class="cm-variable">code</span>)){</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//验证码错误，告诉用户，页面提示</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">request</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"msg"</span>,<span class="cm-string">"验证码错误"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/login.jsp"</span>).<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>,<span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//验证码正确，登录逻辑执行</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//获取用户名和密码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">username</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"username"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">password</span> <span class="cm-operator">=</span> <span class="cm-variable">request</span>.<span class="cm-variable">getParameter</span>(<span class="cm-string">"password"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//调用Service方法，登录用户</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">UserDao</span> <span class="cm-variable">userDao</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">UserDaoImpl</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-variable">User</span> <span class="cm-variable">loginUser</span> <span class="cm-operator">=</span> <span class="cm-variable">userDao</span>.<span class="cm-variable">login</span>(<span class="cm-variable">username</span>,<span class="cm-variable">password</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">if</span>(<span class="cm-variable">loginUser</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span>){</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">request</span>.<span class="cm-variable">setAttribute</span>(<span class="cm-string">"msg"</span>,<span class="cm-string">"用户名或则密码错误"</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">request</span>.<span class="cm-variable">getRequestDispatcher</span>(<span class="cm-string">"/login.jsp"</span>).<span class="cm-variable">forward</span>(<span class="cm-variable">request</span>,<span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}<span class="cm-keyword">else</span>{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-comment">//登陆成功，跳转主页</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">response</span>.<span class="cm-variable">sendRedirect</span>(<span class="cm-variable">request</span>.<span class="cm-variable">getContextPath</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">return</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable-3">void</span> <span class="cm-variable">doPost</span>(<span class="cm-variable">HttpServletRequest</span> <span class="cm-variable">request</span>, <span class="cm-variable">HttpServletResponse</span> <span class="cm-variable">response</span>) <span class="cm-keyword">throws</span> <span class="cm-variable">ServletException</span>, <span class="cm-variable">IOException</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">doGet</span>(<span class="cm-variable">request</span>, <span class="cm-variable">response</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>​</p></li><li><p>dao：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">接口：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">dao</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">domain</span>.<span class="cm-variable">User</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">interface</span> <span class="cm-def">UserDao</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-comment">/**</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span> <span class="cm-comment">* 查询用户名和密码是否匹配的方法</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span> <span class="cm-comment">* @param username</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span> <span class="cm-comment">* @param password</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span> <span class="cm-comment">* @return</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-variable">User</span> <span class="cm-variable">login</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">password</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">=================</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">实现类：</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">package</span> <span class="cm-def">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">dao</span>.<span class="cm-variable">impl</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">dao</span>.<span class="cm-variable">UserDao</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">domain</span>.<span class="cm-variable">User</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">cn</span>.<span class="cm-variable">itcast</span>.<span class="cm-variable">utils</span>.<span class="cm-variable">JDBCUtils</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">jdbc</span>.<span class="cm-variable">core</span>.<span class="cm-variable">BeanPropertyRowMapper</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">org</span>.<span class="cm-variable">springframework</span>.<span class="cm-variable">jdbc</span>.<span class="cm-variable">core</span>.<span class="cm-variable">JdbcTemplate</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">public</span> <span class="cm-keyword">class</span> <span class="cm-def">UserDaoImpl</span> <span class="cm-keyword">implements</span> <span class="cm-variable">UserDao</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">private</span> <span class="cm-variable">JdbcTemplate</span> <span class="cm-variable">template</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">JdbcTemplate</span>(<span class="cm-variable">JDBCUtils</span>.<span class="cm-variable">getDataSource</span>());</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-meta">@Override</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-keyword">public</span> <span class="cm-variable">User</span> <span class="cm-variable">login</span>(<span class="cm-variable-3">String</span> <span class="cm-variable">username</span>, <span class="cm-variable-3">String</span> <span class="cm-variable">password</span>) {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable-3">String</span> <span class="cm-variable">sql</span> <span class="cm-operator">=</span> <span class="cm-string">"select * from user where username = ? and password = ?"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">try</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">User</span> <span class="cm-variable">query</span> <span class="cm-operator">=</span> <span class="cm-variable">template</span>.<span class="cm-variable">queryForObject</span>(<span class="cm-variable">sql</span>, <span class="cm-keyword">new</span> <span class="cm-variable">BeanPropertyRowMapper</span><span class="cm-operator">&lt;</span><span class="cm-variable">User</span><span class="cm-operator">&gt;</span>(<span class="cm-variable">User</span>.<span class="cm-keyword">class</span>), <span class="cm-variable">username</span>,<span class="cm-variable">password</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">return</span> <span class="cm-variable">query</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}<span class="cm-keyword">catch</span> (<span class="cm-variable">Exception</span> <span class="cm-variable">e</span>){</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-variable">e</span>.<span class="cm-variable">printStackTrace</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-tab">    </span><span class="cm-keyword">return</span> <span class="cm-atom">null</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre></li></ol><p></p><p>​  <br/></p></div>
</body>
</html>