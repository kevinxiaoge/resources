<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>Day16-MySQL多表查询与事务.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); white-space: nowrap; background-color: rgb(247, 247, 247); }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; z-index: 1; background: rgb(119, 238, 119); }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: black; }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.CodeMirror-activeline-background { background: rgb(232, 242, 255); }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background: transparent; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; color: rgb(51, 51, 51); overflow-x: hidden; background-color: rgb(255, 255, 255); }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: rgb(181, 214, 252); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences, pre.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: pre; position: relative !important; background: inherit; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number pre.md-fences { padding-left: 0px; }
.show-fences-line-number pre.md-fences.mock-cm { padding-left: 40px; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background: transparent; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { page-break-after: avoid; orphans: 2; }
  p { orphans: 4; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
#write pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; display: block; background: rgb(204, 204, 204); }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
.md-toc-h6 { margin-left: 12em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 8em; }
  .md-toc-h6 { margin-left: 9.5em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; text-decoration: initial !important; text-shadow: initial !important; background: transparent !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: normal; src: local(Open Sans Regular), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: normal; src: local(Open Sans Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400i.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: bold; src: local(Open Sans Bold), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: bold; src: local(Open Sans Bold Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700i.woff) format(woff); }
html { font-size: 16px; }
body { font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; -webkit-font-smoothing: antialiased; }
#write { max-width: 800px; margin: 0px auto; padding: 20px 30px 40px; }
#write::after { height: 80px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; -webkit-font-smoothing: antialiased; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); background-color: rgb(231, 231, 231); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); margin: 0px; padding: 0px; background-color: white; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); }
pre.md-fences, .md-fences, code, tt { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; background-color: rgb(248, 248, 248); }
pre.md-fences, .md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  table, pre { page-break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; background-color: rgb(247, 247, 247); }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; background-color: rgb(248, 248, 248); }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; background-color: rgb(250, 250, 250); }


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-c1' class='md-header-anchor '></a>MySQL多表查询与事务</h1><h2><a name='header-c6' class='md-header-anchor '></a>学习目标</h2><ol><li>能够使用内连接进行多表查询(重点掌握)</li><li>能够使用左外连接和右外连接进行多表查询(掌握一个)</li><li>能够使用子查询进行多表查询(重点掌握)</li><li>能够理解多表查询的规律(理解)</li><li>能够理解事务的概念(理解):知道什么时候使用事务</li><li>能够说出事务的原理(了解)</li><li>能够在MySQL中使用事务(了解)：不用记忆</li><li>能够理解脏读,不可重复读,幻读的概念及解决办法(了解):不用记</li><li>能够使用DCL处理MySQL中的用户(了解):知道怎么复制就行</li></ol><h1><a name='header-c36' class='md-header-anchor '></a>第1章 多表查询</h1><h2><a name='header-c37' class='md-header-anchor '></a>1.1 什么是多表查询</h2><p>同时查询多张表获取到需要的数据
比如：我们想查询到开发部有多少人，需要将部门表和员工表同时进行查询
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A201.png' alt='' /></p><p><strong>多表查询的分类</strong>：
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A202.png' alt='' /></p><p><strong>准备数据</strong>:</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 创建部门表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> dept (</span></pre><pre class=""><span style="padding-right: 0.1px;">  id <span class="cm-builtin">INT</span> PRIMARY KEY AUTO_INCREMENT,</span></pre><pre class=""><span style="padding-right: 0.1px;">  NAME <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">20</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> dept (NAME) <span class="cm-keyword">VALUES</span> (<span class="cm-string">'开发部'</span>),(<span class="cm-string">'市场部'</span>),(<span class="cm-string">'财务部'</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 创建员工表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> emp (</span></pre><pre class=""><span style="padding-right: 0.1px;">  id <span class="cm-builtin">INT</span> PRIMARY KEY AUTO_INCREMENT,</span></pre><pre class=""><span style="padding-right: 0.1px;">  NAME <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">10</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">  gender <span class="cm-builtin">CHAR</span>(<span class="cm-number">1</span>), &nbsp; <span class="cm-comment">-- 性别</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  salary <span class="cm-builtin">DOUBLE</span>, &nbsp; <span class="cm-comment">-- 工资</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  join_date <span class="cm-builtin">DATE</span>,  <span class="cm-comment">-- 入职日期</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  dept_id <span class="cm-builtin">INT</span></span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="cm-keyword">VALUES</span>(<span class="cm-string">'孙悟空'</span>,<span class="cm-string">'男'</span>,<span class="cm-number">7200</span>,<span class="cm-string">'2013-02-24'</span>,<span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="cm-keyword">VALUES</span>(<span class="cm-string">'猪八戒'</span>,<span class="cm-string">'男'</span>,<span class="cm-number">3600</span>,<span class="cm-string">'2010-12-02'</span>,<span class="cm-number">2</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="cm-keyword">VALUES</span>(<span class="cm-string">'唐僧'</span>,<span class="cm-string">'男'</span>,<span class="cm-number">9000</span>,<span class="cm-string">'2008-08-08'</span>,<span class="cm-number">2</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="cm-keyword">VALUES</span>(<span class="cm-string">'白骨精'</span>,<span class="cm-string">'女'</span>,<span class="cm-number">5000</span>,<span class="cm-string">'2015-10-07'</span>,<span class="cm-number">3</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(NAME,gender,salary,join_date,dept_id) <span class="cm-keyword">VALUES</span>(<span class="cm-string">'蜘蛛精'</span>,<span class="cm-string">'女'</span>,<span class="cm-number">4500</span>,<span class="cm-string">'2011-03-14'</span>,<span class="cm-number">1</span>);</span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c48' class='md-header-anchor '></a>1.2 笛卡尔积现象</h2><h3><a name='header-c49' class='md-header-anchor '></a>1.2.1 什么是笛卡尔积现象</h3><p>多表查询时左表的每条数据和右表的每条数据组合，这种效果成为笛卡尔积</p><p>需求：查询每个部门有哪些人</p><p>具体操作：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept, emp;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A203.png' alt='' /></p><p>以上数据其实是左表的每条数据和右表的每条数据组合。左表有3条，右表有5条，最终组合后3*5=15条数据。</p><p><strong>左表的每条数据和右表的每条数据组合，这种效果称为笛卡尔乘积</strong>
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A204.png' alt='' /></p><h3><a name='header-c64' class='md-header-anchor '></a>1.2.2 如何清除笛卡尔积现象的影响</h3><p>我们发现不是所有的数据组合都是有用的，只有员工表.dept_id = 部门表.id 的数据才是有用的。所以需要通过条件过滤掉没用的数据。
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A205.png' alt='' /></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept, emp <span class="cm-keyword">WHERE</span> emp.`dept_id`=dept.`id`; </span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A206.png' alt='' /></p><h2><a name='header-c71' class='md-header-anchor '></a>1.3 内连接</h2><p><strong>用左边表的记录去匹配右边表的记录，如果符合条件的则显示</strong></p><h3><a name='header-c74' class='md-header-anchor '></a>1.3.1 隐式内连接</h3><p>隐式内连接：看不到<code>JOIN</code>关键字，条件使用<code>WHERE</code>指定
<code>SELECT 字段名 FROM 左表, 右表 WHERE 条件；</code></p><h3><a name='header-c78' class='md-header-anchor '></a>1.3.2 显示内连接</h3><p>显示内连接：使用<code>INNER JOIN ... ON</code>语句, 可以省略<code>INNER</code>
<code>SELECT 字段名 FROM 左表 INNER JOIN 右表 ON 条件；</code></p><p>具体操作：</p><ul><li>查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称，我们发现需要联合2张表同时才能查询出需要的数据，我们使用内连接</li></ul><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A215.png' alt='' /></p><ol><li>确定查询哪些表</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept INNER <span class="cm-keyword">JOIN</span> emp;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A207.png' alt='' /></p><ol><li>确定表连接条件，员工表.dept_id = 部门表.id 的数据才是有效的</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept INNER <span class="cm-keyword">JOIN</span> emp <span class="cm-keyword">ON</span> emp.`dept_id`=dept.`id`;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A208.png' alt='' /></p><ol><li>确定表连接条件，我们查询的是唐僧的信息，部门表.name=&#39;唐僧&#39;</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept INNER <span class="cm-keyword">JOIN</span> emp <span class="cm-keyword">ON</span> emp.`dept_id`=dept.`id` <span class="cm-keyword">AND</span> emp.`NAME`=<span class="cm-string">'唐僧'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A209.png' alt='' /></p><ol><li>确定查询字段，查询唐僧的信息，显示员工id，姓名，性别，工资和所在的部门名称</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> emp.`id`, emp.`NAME`, emp.`gender`, emp.`salary`, dept.`NAME` <span class="cm-keyword">FROM</span> dept INNER <span class="cm-keyword">JOIN</span> emp <span class="cm-keyword">ON</span> emp.`dept_id`=dept.`id` <span class="cm-keyword">AND</span> emp.`NAME`=<span class="cm-string">'唐僧'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A210.png' alt='' /></p><ol><li>我们发现写表名有点长，可以给表取别名，显示的字段名也使用别名</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> e.`id` 员工编号, e.`NAME` 员工姓名, e.`gender` 性别, e.`salary` 工资, d.`NAME` 部门名称 <span class="cm-keyword">FROM</span> dept d INNER <span class="cm-keyword">JOIN</span> emp e <span class="cm-keyword">ON</span> e.`dept_id`=d.`id` <span class="cm-keyword">AND</span> e.`NAME`=<span class="cm-string">'唐僧'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A211.png' alt='' /></p><p><strong>总结内连接查询步骤：</strong></p><ol><li>确定查询哪些表</li><li>确定表连接条件</li><li>确定查询字段</li></ol><h2><a name='header-c137' class='md-header-anchor '></a>1.4 左外连接</h2><p>左外连接：使用<code>LEFT OUTER JOIN ... ON</code>，<code>OUTER</code>可以省略
<code>SELECT 字段名 FROM 左表 LEFT OUTER JOIN 右表 ON 条件；</code>
用左边表的记录去匹配右边表的记录，如果符合条件的则显示；否则，显示NULL
可以理解为：在内连接的基础上保证左表的数据全部显示</p><p>具体操作：</p><ul><li>在部门表中增加一个销售部</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> dept (NAME) <span class="cm-keyword">VALUES</span> (<span class="cm-string">'销售部'</span>);</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A212.png' alt='' /></p><ul><li>使用内连接查询</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept INNER <span class="cm-keyword">JOIN</span> emp <span class="cm-keyword">ON</span> emp.`dept_id`=dept.`id`;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A213.png' alt='' /></p><ul><li>使用左外连接查询</li></ul><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept LEFT OUTER <span class="cm-keyword">JOIN</span> emp <span class="cm-keyword">ON</span> emp.`dept_id`=dept.`id`;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A214.png' alt='' /></p><h2><a name='header-c166' class='md-header-anchor '></a>1.5 右外连接</h2><p>右外连接：使用<code>RIGHT OUTER JOIN ... ON</code>，<code>OUTER</code>可以省略
<code>SELECT 字段名 FROM 左表 RIGHT OUTER JOIN 右表 ON 条件；</code>
用右边表的记录去匹配左边表的记录，如果符合条件的则显示；否则，显示NULL
可以理解为：在内连接的基础上保证右表的数据全部显示</p><p>具体操作：</p><ul><li>在员工表中增加一个员工
INSERT INTO emp(NAME,gender,salary,join_date,dept_id) VALUES(&#39;沙僧&#39;,&#39;男&#39;,6666,&#39;2013-02-24&#39;,NULL);
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A217.png' alt='' /></li><li>使用内连接查询
SELECT * FROM dept INNER JOIN emp ON emp.<code>dept_id</code>=dept.<code>id</code>;
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A213.png' alt='' /></li><li>使用右外连接查询
SELECT * FROM dept RIGHT OUTER JOIN emp ON emp.<code>dept_id</code>=dept.<code>id</code>;
<img src='imgs/%E8%A1%A8%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A216.png' alt='' /></li></ul><h2><a name='header-c190' class='md-header-anchor '></a>1.6 子查询</h2><p>一条SELECT语句结果作为另一条SELECT语法一部分（查询条件，查询结果，表）
<code>SELECT 查询字段 FROM 表 WHERE 查询条件;</code>
<code>SELECT * FROM employee WHERE salary=(SELECT MAX(salary) FROM employee);</code>
<img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A201.png' alt='' />
子查询需要放在（）中</p><p>子查询结果的三种情况：</p><ol><li>子查询的结果是一个值的时候
<img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A202.png' alt='' /></li><li>子查询结果是单例多行的时候
<img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A203.png' alt='' /></li><li>子查询的结果是多行多列
<img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A204.png' alt='' /></li></ol><blockquote><p>说明：
子查询结果只要是<code>单列</code>，肯定在<code>WHERE</code>后面作为<code>条件</code>
子查询结果只要是<code>多列</code>，肯定在<code>FROM</code>后面作为<code>表</code></p></blockquote><h3><a name='header-c217' class='md-header-anchor '></a>1.1.1 子查询的结果是一个值的时候</h3><p>子查询结果只要是<code>单列</code>，肯定在<code>WHERE</code>后面作为<code>条件</code>
<code>SELECT 查询字段 FROM 表 WHERE 字段=（子查询）;</code></p><ol><li><p><strong>查询工资最高的员工是谁？</strong> </p><ol><li>查询最高工资是多少</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> MAX(salary) <span class="cm-keyword">FROM</span> emp;</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A205.png' alt='' /></p><ol><li>根据最高工资到员工表查询到对应的员工信息</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> salary=(<span class="cm-keyword">SELECT</span> MAX(salary) <span class="cm-keyword">FROM</span> emp);</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A206.png' alt='' /></p></li><li><p><strong>查询工资小于平均工资的员工有哪些？</strong></p><ol><li>查询平均工资是多少</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> AVG(salary) <span class="cm-keyword">FROM</span> emp;</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A207.png' alt='' /></p><ol><li>到员工表查询小于平均的员工信息</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> salary &lt; (<span class="cm-keyword">SELECT</span> AVG(salary) <span class="cm-keyword">FROM</span> emp);</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A208.png' alt='' /></p></li></ol><h3><a name='header-c256' class='md-header-anchor '></a>1.1.2 子查询结果是单列多行的时候</h3><p>子查询结果只要是<code>单列</code>，肯定在<code>WHERE</code>后面作为<code>条件</code>
子查询结果是单列多行，结果集类似于一个数组，父查询使用<code>IN</code>运算符
<code>SELECT 查询字段 FROM 表 WHERE 字段 IN （子查询）;</code></p><ol><li><p><strong>查询工资大于5000的员工，来自于哪些部门的名字</strong><br/></p><ol><li>先查询大于5000的员工所在的部门id</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> dept_id <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> salary &gt; <span class="cm-number">5000</span>;</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A209.png' alt='' /></p><ol><li>再查询在这些部门id中部门的名字</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> dept<span class="cm-variable-2">.name</span> <span class="cm-keyword">FROM</span> dept <span class="cm-keyword">WHERE</span> dept<span class="cm-variable-2">.id</span> <span class="cm-keyword">IN</span> (<span class="cm-keyword">SELECT</span> dept_id <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> salary &gt; <span class="cm-number">5000</span>);</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A210.png' alt='' /></p></li><li><p><strong>查询开发部与财务部所有的员工信息</strong></p><ol><li>先查询开发部与财务部的id</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> id <span class="cm-keyword">FROM</span> dept <span class="cm-keyword">WHERE</span> NAME <span class="cm-keyword">IN</span>(<span class="cm-string">'开发部'</span>,<span class="cm-string">'财务部'</span>);</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A211.png' alt='' /></p><ol><li>再查询在这些部门id中有哪些员工</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> dept_id <span class="cm-keyword">IN</span> (<span class="cm-keyword">SELECT</span> id <span class="cm-keyword">FROM</span> dept <span class="cm-keyword">WHERE</span> NAME <span class="cm-keyword">IN</span>(<span class="cm-string">'开发部'</span>,<span class="cm-string">'财务部'</span>));</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A212.png' alt='' /></p></li></ol><h3><a name='header-c296' class='md-header-anchor '></a>1.1.3 子查询的结果是多行多列</h3><p>子查询结果只要是<code>多列</code>，肯定在<code>FROM</code>后面作为<code>表</code>
<code>SELECT 查询字段 FROM （子查询） 表别名 WHERE 条件;</code>
子查询作为表需要取别名，否则这张表没用名称无法访问表中的字段</p><ul><li><p><strong>查询出2011年以后入职的员工信息，包括部门名称</strong></p><ol><li>在员工表中查询2011-1-1以后入职的员工</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> join_date &gt; <span class="cm-string">'2011-1-1'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A214.png' alt='' /></p><ol><li>查询所有的部门信息，与上面的虚拟表中的信息组合，找出所有部门id等于的dept_id</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept d, (<span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp <span class="cm-keyword">WHERE</span> join_date &gt; <span class="cm-string">'2011-1-1'</span>) e <span class="cm-keyword">WHERE</span> e<span class="cm-variable-2">.dept_id</span> = d<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs/%E5%AD%90%E6%9F%A5%E8%AF%A213.png' alt='' /></p></li></ul><p>使用表连接则更加简单：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept d INNER <span class="cm-keyword">JOIN</span> emp e <span class="cm-keyword">ON</span> d<span class="cm-variable-2">.id</span> = e<span class="cm-variable-2">.dept_id</span> <span class="cm-keyword">WHERE</span> e<span class="cm-variable-2">.join_date</span> &gt; <span class="cm-string">'2011-1-1'</span>;</span></pre></div></div></div></div></div></div></div></pre><h3><a name='header-c322' class='md-header-anchor '></a>1.1.4 子查询总结</h3><blockquote><ul><li>子查询结果只要是<code>单列</code>，肯定在<code>WHERE</code>后面作为<code>条件</code>
<code>SELECT 查询字段 FROM 表 WHERE 字段=（子查询）;</code></li><li>子查询结果只要是<code>多列</code>，肯定在<code>FROM</code>后面作为<code>表</code>
<code>SELECT 查询字段 FROM （子查询） 表别名 WHERE 条件;</code></li></ul></blockquote><h1><a name='header-c333' class='md-header-anchor '></a>第2章 多表查询案例</h1><p>​	我们在公司开发中，根据不同的业务需求往往需要通过2张及以上的表中去查询需要的数据。所以我们有必要学习2张及以上的表的查询。其实不管是几张表的查询，都是有规律可循的。</p><h2><a name='header-c335' class='md-header-anchor '></a>2.1 准备数据</h2><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 部门表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> dept (</span></pre><pre class=""><span style="padding-right: 0.1px;">  id <span class="cm-builtin">INT</span> PRIMARY KEY PRIMARY KEY, <span class="cm-comment">-- 部门id</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  dname <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">50</span>), <span class="cm-comment">-- 部门名称</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  loc <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">50</span>) <span class="cm-comment">-- 部门位置</span></span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 添加4个部门</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> dept(id,dname,loc) <span class="cm-keyword">VALUES</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">10</span>,<span class="cm-string">'教研部'</span>,<span class="cm-string">'北京'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">20</span>,<span class="cm-string">'学工部'</span>,<span class="cm-string">'上海'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">30</span>,<span class="cm-string">'销售部'</span>,<span class="cm-string">'广州'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">40</span>,<span class="cm-string">'财务部'</span>,<span class="cm-string">'深圳'</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 职务表，职务名称，职务描述</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> job (</span></pre><pre class=""><span style="padding-right: 0.1px;">  id <span class="cm-builtin">INT</span> PRIMARY KEY,</span></pre><pre class=""><span style="padding-right: 0.1px;">  jname <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">  description <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">50</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 添加4个职务</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> job (id, jname, description) <span class="cm-keyword">VALUES</span></span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1</span>, <span class="cm-string">'董事长'</span>, <span class="cm-string">'管理整个公司，接单'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">2</span>, <span class="cm-string">'经理'</span>, <span class="cm-string">'管理部门员工'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">3</span>, <span class="cm-string">'销售员'</span>, <span class="cm-string">'向客人推销产品'</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">4</span>, <span class="cm-string">'文员'</span>, <span class="cm-string">'使用办公软件'</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 员工表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> emp (</span></pre><pre class=""><span style="padding-right: 0.1px;">  id <span class="cm-builtin">INT</span> PRIMARY KEY, <span class="cm-comment">-- 员工id</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  ename <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">50</span>), <span class="cm-comment">-- 员工姓名</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  job_id <span class="cm-builtin">INT</span>, <span class="cm-comment">-- 职务id</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  mgr <span class="cm-builtin">INT</span> , <span class="cm-comment">-- 上级领导</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  joindate <span class="cm-builtin">DATE</span>, <span class="cm-comment">-- 入职日期</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  salary <span class="cm-builtin">DECIMAL</span>(<span class="cm-number">7</span>,<span class="cm-number">2</span>), <span class="cm-comment">-- 工资</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  bonus <span class="cm-builtin">DECIMAL</span>(<span class="cm-number">7</span>,<span class="cm-number">2</span>), <span class="cm-comment">-- 奖金</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  dept_id <span class="cm-builtin">INT</span>, <span class="cm-comment">-- 所在部门编号</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  CONSTRAINT emp_jobid_ref_job_id_fk FOREIGN KEY (job_id) REFERENCES job (id),</span></pre><pre class=""><span style="padding-right: 0.1px;">  CONSTRAINT emp_deptid_ref_dept_id_fk FOREIGN KEY (dept_id) REFERENCES dept (id)</span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 添加员工</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> emp(id,ename,job_id,mgr,joindate,salary,bonus,dept_id) <span class="cm-keyword">VALUES</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1001</span>,<span class="cm-string">'孙悟空'</span>,<span class="cm-number">4</span>,<span class="cm-number">1004</span>,<span class="cm-string">'2000-12-17'</span>,<span class="cm-string">'8000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1002</span>,<span class="cm-string">'卢俊义'</span>,<span class="cm-number">3</span>,<span class="cm-number">1006</span>,<span class="cm-string">'2001-02-20'</span>,<span class="cm-string">'16000.00'</span>,<span class="cm-string">'3000.00'</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1003</span>,<span class="cm-string">'林冲'</span>,<span class="cm-number">3</span>,<span class="cm-number">1006</span>,<span class="cm-string">'2001-02-22'</span>,<span class="cm-string">'12500.00'</span>,<span class="cm-string">'5000.00'</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1004</span>,<span class="cm-string">'唐僧'</span>,<span class="cm-number">2</span>,<span class="cm-number">1009</span>,<span class="cm-string">'2001-04-02'</span>,<span class="cm-string">'29750.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1005</span>,<span class="cm-string">'李逵'</span>,<span class="cm-number">4</span>,<span class="cm-number">1006</span>,<span class="cm-string">'2001-09-28'</span>,<span class="cm-string">'12500.00'</span>,<span class="cm-string">'14000.00'</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1006</span>,<span class="cm-string">'宋江'</span>,<span class="cm-number">2</span>,<span class="cm-number">1009</span>,<span class="cm-string">'2001-05-01'</span>,<span class="cm-string">'28500.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1007</span>,<span class="cm-string">'刘备'</span>,<span class="cm-number">2</span>,<span class="cm-number">1009</span>,<span class="cm-string">'2001-09-01'</span>,<span class="cm-string">'24500.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">10</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1008</span>,<span class="cm-string">'猪八戒'</span>,<span class="cm-number">4</span>,<span class="cm-number">1004</span>,<span class="cm-string">'2007-04-19'</span>,<span class="cm-string">'30000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1009</span>,<span class="cm-string">'罗贯中'</span>,<span class="cm-number">1</span>,<span class="cm-atom">NULL</span>,<span class="cm-string">'2001-11-17'</span>,<span class="cm-string">'50000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">10</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1010</span>,<span class="cm-string">'吴用'</span>,<span class="cm-number">3</span>,<span class="cm-number">1006</span>,<span class="cm-string">'2001-09-08'</span>,<span class="cm-string">'15000.00'</span>,<span class="cm-string">'0.00'</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1011</span>,<span class="cm-string">'沙僧'</span>,<span class="cm-number">4</span>,<span class="cm-number">1004</span>,<span class="cm-string">'2007-05-23'</span>,<span class="cm-string">'11000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1012</span>,<span class="cm-string">'李逵'</span>,<span class="cm-number">4</span>,<span class="cm-number">1006</span>,<span class="cm-string">'2001-12-03'</span>,<span class="cm-string">'9500.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">30</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1013</span>,<span class="cm-string">'小白龙'</span>,<span class="cm-number">4</span>,<span class="cm-number">1004</span>,<span class="cm-string">'2001-12-03'</span>,<span class="cm-string">'30000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">20</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1014</span>,<span class="cm-string">'关羽'</span>,<span class="cm-number">4</span>,<span class="cm-number">1007</span>,<span class="cm-string">'2002-01-23'</span>,<span class="cm-string">'13000.00'</span>,<span class="cm-atom">NULL</span>,<span class="cm-number">10</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 工资等级表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> salarygrade (</span></pre><pre class=""><span style="padding-right: 0.1px;">  grade <span class="cm-builtin">INT</span> PRIMARY KEY,</span></pre><pre class=""><span style="padding-right: 0.1px;">  losalary <span class="cm-builtin">INT</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">  hisalary <span class="cm-builtin">INT</span></span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 添加5个工资等级</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> salarygrade(grade,losalary,hisalary) <span class="cm-keyword">VALUES</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">1</span>,<span class="cm-number">7000</span>,<span class="cm-number">12000</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">2</span>,<span class="cm-number">12010</span>,<span class="cm-number">14000</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">3</span>,<span class="cm-number">14010</span>,<span class="cm-number">20000</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">4</span>,<span class="cm-number">20010</span>,<span class="cm-number">30000</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;">(<span class="cm-number">5</span>,<span class="cm-number">30010</span>,<span class="cm-number">99990</span>);</span></pre></div></div></div></div></div></div></div></pre><p>分析4张表的关系：通过4张表可以查出一个员工的所有信息
<img src='imgs\多表查询01.png' alt='' /></p><h2><a name='header-c341' class='md-header-anchor '></a>2.2 练习</h2><h3><a name='header-c342' class='md-header-anchor '></a>2.2.1 练习1</h3><p>查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述</p><p>具体操作：
   1.确定要查询哪些表：emp e, job j</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询02.png' alt='' /></p><p>   2.确定表连接条件： e.job_id=j.id</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询03.png' alt='' />
   <img src='imgs\多表查询04.png' alt='' /></p><p>   3.确定查询字段：员工编号，员工姓名，工资，职务名称，职务描述</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`id`, e.`ename`, e.`salary`, j.`jname`, j.`description` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询05.png' alt='' /></p><h3><a name='header-c363' class='md-header-anchor '></a>2.2.2 练习2</h3><p>查询所有员工信息。显示员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, job j, dept d</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询06.png' alt='' />
   <img src='imgs\多表查询07.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.job_id=j.id and e.dept_id=d.id</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询08.png' alt='' />
   <img src='imgs\多表查询09.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`id`, e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询10.png' alt='' /></p><h3><a name='header-c382' class='md-header-anchor '></a>2.2.3 练习3</h3><p>查询所有员工信息。显示员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, job j, dept d, salarygrade s</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询11.png' alt='' />
   <img src='imgs\多表查询12.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.job_id=j.id and e.dept_id=d.id and e.salary between s.losalary and hisalary</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> s<span class="cm-variable-2">.hisalary</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询13.png' alt='' />
   <img src='imgs\多表查询14.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc`, s.`grade` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> hisalary;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询15.png' alt='' /></p><h4><a name='header-c400' class='md-header-anchor '></a>1.2.3.1 多表查询规律总结</h4><ol><li>不管我们查询几张表，表连接查询会产出笛卡尔积，我们需要消除笛卡尔积，拿到正确的数据。我们需要找到表与表之间通过哪个字段关联起来的（通常是<code>外键=主键</code>）</li><li>消除笛卡尔积规律：2张表需要1个条件，3张表需要2个条件，4张表需要3个条件。（条件数量=表的数量-1），每张表都要参与进来</li><li>多表连接查询步骤：
3.1. 确定要查询哪些表
3.2. 确定表连接条件
3.3. 确定查询字段</li></ol><h3><a name='header-c415' class='md-header-anchor '></a>2.2.4 练习4</h3><p>查询经理的信息。显示员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, job j, dept d, salarygrade s</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询11.png' alt='' />
   <img src='imgs\多表查询12.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.job_id=j.id and e.dept_id=d.id and e.salary between s.losalary and hisalary</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> hisalary;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询13.png' alt='' />
   <img src='imgs\多表查询14.png' alt='' /></p><p>   额外条件：只需要查询经理的信息（j.jname=&#39;经理&#39;）
   <img src='imgs\多表查询16.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`ename`, e.`salary`, j.`jname`, j.`description`, d.`dname`, d.`loc`, s.`grade` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> hisalary <span class="cm-keyword">AND</span> j<span class="cm-variable-2">.jname</span>=<span class="cm-string">'经理'</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询17.png' alt='' /></p><h3><a name='header-c437' class='md-header-anchor '></a>2.2.5 练习5</h3><p>查询出部门编号、部门名称、部门位置、部门人数</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 去员工表中找到每个部门的人数和部门id</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> dept_id, <span class="cm-keyword">COUNT</span>(*) <span class="cm-keyword">FROM</span> emp GROUP <span class="cm-keyword">BY</span> dept_id;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询18.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 再和部门表连接查询</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> dept d INNER <span class="cm-keyword">JOIN</span> (<span class="cm-keyword">SELECT</span> dept_id, <span class="cm-keyword">COUNT</span>(*) <span class="cm-keyword">FROM</span> emp GROUP <span class="cm-keyword">BY</span> dept_id) e <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.dept_id</span>=d.`id`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询19.png' alt='' />
   <img src='imgs\多表查询20.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 显示对应的字段</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> d.`id`, d<span class="cm-variable-2">.dname</span>, d.`loc`, e<span class="cm-variable-2">.total</span> 部门人数 <span class="cm-keyword">FROM</span> dept d INNER <span class="cm-keyword">JOIN</span> (<span class="cm-keyword">SELECT</span> dept_id, <span class="cm-keyword">COUNT</span>(*) total <span class="cm-keyword">FROM</span> emp GROUP <span class="cm-keyword">BY</span> dept_id) e <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.dept_id</span>=d.`id`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询21.png' alt='' />
   最终效果：
   <img src='imgs\多表查询22.png' alt='' /></p><h3><a name='header-c457' class='md-header-anchor '></a>2.2.6 练习6</h3><p>查询所有员工信息。显示员工信息和部门名称，没有员工的部门也要显示</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, dept d</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> dept d;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询23.png' alt='' />
   <img src='imgs\多表查询24.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.dept_id=d.id，没有员工的部门也要显示。右边数据要全部显示所以使用右外连接</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e RIGHT <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询25.png' alt='' />
   <img src='imgs\多表查询26.png' alt='' /></p><p>   注意：没有员工的部门也要显示。右边数据要全部显示所以使用右外连接
   <img src='imgs\多表查询27.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工信息，部门名称</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.*, d.`dname` <span class="cm-keyword">FROM</span> emp e RIGHT <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询28.png' alt='' /></p><h3><a name='header-c479' class='md-header-anchor '></a>2.2.7 练习7</h3><p>查询所有员工信息。显示员工姓名，员工工资，职务名称，工资等级，并按工资升序排序</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, job j, salarygrade s</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> salarygrade s;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询29.png' alt='' />
   <img src='imgs\多表查询30.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.job_id=j.id and e.salary between s.losalary and s.hisalary</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> s<span class="cm-variable-2">.hisalary</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询31.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工姓名，员工工资，工资等级，并按工资升序排序</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`ename`, j.`jname`, e.`salary`, s.`grade` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> job j INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.job_id</span>=j<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> s<span class="cm-variable-2">.hisalary</span> <span class="cm-keyword">ORDER</span> <span class="cm-keyword">BY</span> e.`salary`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询32.png' alt='' /></p><h3><a name='header-c497' class='md-header-anchor '></a>2.2.8 练习8</h3><p>列出所有员工的姓名及其直接上级的姓名,没有领导的员工也需要显示</p><p>具体操作：
   <img src='imgs\多表查询33.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, emp m</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询34.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.mgr=e2.id</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m <span class="cm-keyword">ON</span> e.`mgr`=m.`id`;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e LEFT <span class="cm-keyword">JOIN</span> emp m <span class="cm-keyword">ON</span> e.`mgr`=m.`id`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询35.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  **我们发现少了一条数据，因为罗贯中是董事长没有上司**
  没有领导的员工也需要显示，所以左表的数据需要全部显示。使用左外连接
  ![](imgs\多表查询36.png)

  3. 确定查询字段：员工的姓名及其直接上级的姓名</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`ename`, IFNULL(m.`ename`, <span class="cm-string">'没有'</span>) 上司 <span class="cm-keyword">FROM</span> emp e LEFT <span class="cm-keyword">JOIN</span> emp m <span class="cm-keyword">ON</span> e.`mgr`=m.`id`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询37.png' alt='' /></p><h3><a name='header-c515' class='md-header-anchor '></a>2.2.9 练习9</h3><p>查询入职期早于直接上级的所有员工编号、姓名、部门名称</p><p>具体操作：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, emp m, dept d</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询38.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.mgr=m.id and e.dept_id=d.id and e.dept_id=d.id and e.joindate&lt;m.joindate</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.mgr</span>=m<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.joindate</span>&lt;m<span class="cm-variable-2">.joindate</span>;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询39.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工编号、姓名、部门名称</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">SELECT</span> e.`id`, e.`ename`, d.`dname` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d <span class="cm-keyword">ON</span> e<span class="cm-variable-2">.mgr</span>=m<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.joindate</span>&lt;m<span class="cm-variable-2">.joindate</span> <span class="cm-keyword">AND</span> e.`dept_id`=d.`id`;</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\多表查询40.png' alt='' /></p><h3><a name='header-c532' class='md-header-anchor '></a>2.2.10 练习10</h3><p>查询工资高于公司平均工资的所有员工信息。显示员工信息，部门名称，上级领导，工资等级</p><p>具体操作：
  <strong>先统计公司平均工资</strong></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> AVG(salary) <span class="cm-keyword">FROM</span> emp;</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs\多表查询41.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. 确定要查询哪些表，emp e, emp m, dept d, salarygrade s</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s;</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs\多表查询42.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  2. 确定表连接条件 e.dept_id=d.id and e.mgr=m.id and e.salary between s.losalary and hisalary and e.salary&gt;公司平均薪金</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> * <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">WHERE</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.mgr</span>=m<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> hisalary <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span>&gt;(<span class="cm-keyword">SELECT</span> AVG(salary) <span class="cm-keyword">FROM</span> emp);</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs\多表查询43.png' alt='' /></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  3. 确定查询字段：员工信息，部门名称，上级领导，工资等级。</pre><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">SELECT</span> e.*, d.`dname`, m.`ename`, s.`grade` <span class="cm-keyword">FROM</span> emp e INNER <span class="cm-keyword">JOIN</span> emp m INNER <span class="cm-keyword">JOIN</span> dept d INNER <span class="cm-keyword">JOIN</span> salarygrade s <span class="cm-keyword">WHERE</span> e<span class="cm-variable-2">.dept_id</span>=d<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.mgr</span>=m<span class="cm-variable-2">.id</span> <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span> <span class="cm-keyword">BETWEEN</span> s<span class="cm-variable-2">.losalary</span> <span class="cm-keyword">AND</span> hisalary <span class="cm-keyword">AND</span> e<span class="cm-variable-2">.salary</span>&gt;(<span class="cm-keyword">SELECT</span> AVG(salary) <span class="cm-keyword">FROM</span> emp);</span></pre></div></div></div></div></div></div></div></pre><p>  <img src='imgs\多表查询44.png' alt='' /></p><h1><a name='header-c554' class='md-header-anchor '></a>第3章 事务安全</h1><h2><a name='header-c555' class='md-header-anchor '></a>3.1 事务的应用场景说明</h2><p>​	在实际的业务开发中，有些业务操作要多次访问数据库。一个业务要发送多条SQL语句给数据库执行。需要将多次访问数据库的操作视为一个整体来执行，要么所有的SQL语句全部执行成功。如果其中有一条SQL语句失败，就进行事务的回滚，所有的SQL语句全部执行失败。
例如: 张三给李四转账，张三账号减钱，李四账号加钱</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 创建数据表</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> <span class="cm-keyword">TABLE</span> account (</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>id <span class="cm-builtin">INT</span> PRIMARY KEY AUTO_INCREMENT,</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>NAME <span class="cm-builtin">VARCHAR</span>(<span class="cm-number">10</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-tab">    </span>balance <span class="cm-builtin">DOUBLE</span></span></pre><pre class=""><span style="padding-right: 0.1px;">);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 添加数据</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">INSERT</span> <span class="cm-keyword">INTO</span> account (NAME, balance) <span class="cm-keyword">VALUES</span> (<span class="cm-string">'张三'</span>, <span class="cm-number">1000</span>), (<span class="cm-string">'李四'</span>, <span class="cm-number">1000</span>);</span></pre></div></div></div></div></div></div></div></pre><p>模拟张三给李四转500元钱，一个转账的业务操作最少要执行下面的2条语句：</p><ol><li>张三账号-500</li><li>李四账号+500</li></ol><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 1. 张三账号-500</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 2. 李四账号+500</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance + <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">2</span>;</span></pre></div></div></div></div></div></div></div></pre><p>​	假设当张三账号上-500元,服务器崩溃了。李四的账号并没有+500元，数据就出现问题了。我们需要保证其中一条SQL语句出现问题，整个转账就算失败。只有两条SQL都成功了转账才算成功。这个时候就需要用到事务</p><h2><a name='header-c572' class='md-header-anchor '></a>3.2 操作事务</h2><p>MYSQL中可以有两种方式进行事务的操作：<code>1.手动提交事务</code>，<code>2.自动提交事务</code></p><h3><a name='header-c575' class='md-header-anchor '></a>3.2.1 手动提交事务</h3><p>  事务有关的SQL语句：</p><table><thead><tr><th>SQL语句</th><th>描述</th></tr></thead><tbody><tr><td>start transaction;</td><td>开启事务</td></tr><tr><td>commit;</td><td>提交事务</td></tr><tr><td>rollback;</td><td>回滚事务</td></tr></tbody></table><p><strong>手动提交事务使用步骤</strong>：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>第1种情况：开启事务 -&gt; 执行SQL语句 -&gt; 成功 -&gt; 提交事务
第2种情况：开启事务 -&gt; 执行SQL语句 -&gt; 失败 -&gt; 回滚事务</pre><p>   <img src='imgs\事务01.png' alt='' /></p><p><strong>案例演示1</strong>：模拟张三给李四转500元钱（成功）
目前数据库数据如下：
<img src='imgs\事务03.png' alt='' /></p><ol><li><p>使用DOS控制台进入MySQL</p></li><li><p>执行以下SQL语句： <code>1.开启事务</code>， <code>2.张三账号-500</code>， <code>3.李四账号+500</code></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">START TRANSACTION;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance + <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">2</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务02.png' alt='' /></p></li><li><p>使用SQLYog查看数据库：发现数据并没有改变
<img src='imgs\事务03.png' alt='' /></p></li><li><p>在控制台执行<code>commit</code>提交任务：
<img src='imgs\事务04.png' alt='' /></p></li><li><p>使用SQLYog查看数据库：发现数据改变
<img src='imgs\事务05.png' alt='' /></p></li></ol><hr /><p><strong>案例演示2</strong>：模拟张三给李四转500元钱（失败）
目前数据库数据如下：
<img src='imgs\事务05.png' alt='' /></p><ol><li><p>在控制台执行以下SQL语句：<code>1.开启事务</code>， <code>2.张三账号-500</code></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">START TRANSACTION;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务06.png' alt='' /></p></li><li><p>使用SQLYog查看数据库：发现数据并没有改变
<img src='imgs\事务07.png' alt='' /></p></li><li><p>在控制台执行<code>rollback</code>回滚事务：
<img src='imgs\事务08.png' alt='' /></p></li><li><p>使用SQLYog查看数据库：发现数据没有改变
<img src='imgs\事务09.png' alt='' /></p></li></ol><blockquote><p>总结:
如果事务中SQL语句没有问题，commit提交事务，会对数据库数据的数据进行改变。
如果事务中SQL语句有问题，rollback回滚事务，会回退到开启事务时的状态。</p></blockquote><h3><a name='header-c651' class='md-header-anchor '></a>3.2.2 自动提交事务</h3><p>​	MySQL的每一条DML(增删改)语句都是一个单独的事务，每条语句都会自动开启一个事务，执行完毕自动提交事务，MySQL默认开始自动提交事务
<img src='imgs\事务10.png' alt='' /></p><ol><li><p>将金额重置为1000
<img src='imgs\事务11.png' alt='' /></p></li><li><p>执行以下SQL语句</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div></div></pre></li><li><p>使用SQLYog查看数据库：发现数据已经改变
<img src='imgs\事务12.png' alt='' /></p><p>通过修改MySQL全局变量&quot;autocommit&quot;，取消自动提交事务
使用SQL语句：<code>show variables like &#39;%commit%&#39;;</code>查看MySQL是否开启自动提交事务
<img src='imgs\事务13.png' alt='' />
0:OFF（关闭自动提交）
1:ON（开启自动提交）</p></li><li><p>取消自动提交事务，设置自动提交的参数为OFF，执行SQL语句：<code>set autocommit = 0;</code>
<img src='imgs\事务14.png' alt='' /></p></li><li><p>在控制台执行以下SQL语句：张三-500</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">500</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务15.png' alt='' /></p></li><li><p>使用SQLYog查看数据库，发现数据并没有改变
<img src='imgs\事务16.png' alt='' /></p></li><li><p>在控制台执行<code>commit</code>提交任务
<img src='imgs\事务17.png' alt='' /></p></li><li><p>使用SQLYog查看数据库，发现数据改变
<img src='imgs\事务18.png' alt='' /></p></li></ol><h2><a name='header-c696' class='md-header-anchor '></a>3.3 事务原理(了解)</h2><p>​	事务开启之后, 所有的操作都会临时保存到事务日志, 事务日志只有在得到<code>commit</code>命令才会同步到数据表中，其他任何情况都会清空事务日志(rollback，断开连接)
   <img src='imgs\事务19.png' alt='' /></p><h2><a name='header-c700' class='md-header-anchor '></a>3.4 回滚点(了解)</h2><p>​	在某些成功的操作完成之后，后续的操作有可能成功有可能失败，但是不管成功还是失败，前面操作都已经成功，可以在当前成功的位置设置一个回滚点。可以供后续失败操作返回到该位置，而不是返回所有操作，这个点称之为回滚点。</p><p>设置回滚点语法：<code>savepoint 回滚点名字;</code>
回到回滚点语法: <code>rollback to 回滚点名字;</code></p><p>具体操作：</p><ol><li><p>将数据还原到1000
<img src='imgs\事务20.png' alt='' /></p></li><li><p>开启事务
<img src='imgs\事务21.png' alt='' /></p></li><li><p>让张三账号减3次钱</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务22.png' alt='' /></p></li><li><p>设置回滚点：<code>savepoint abc;</code>
<img src='imgs\事务23.png' alt='' /></p></li><li><p>让张三账号减4次钱</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">UPDATE</span> account <span class="cm-keyword">SET</span> balance = balance - <span class="cm-number">10</span> <span class="cm-keyword">WHERE</span> id=<span class="cm-number">1</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务24.png' alt='' /></p></li><li><p>回到回滚点：<code>rollback to abc;</code>
<img src='imgs\事务25.png' alt='' /></p></li><li><p>分析过程
<img src='imgs\事务26.png' alt='' /></p></li></ol><blockquote><p>总结：设置回滚点可以让我们在失败的时候回到回滚点，而不是回到事务开启的时候。</p></blockquote><h2><a name='header-c744' class='md-header-anchor '></a>3.5 事务的四大特性</h2><h3><a name='header-c745' class='md-header-anchor '></a>3.5.1 事务的四大特性(了解，面试的时候小概率会问)</h3><table><thead><tr><th>事务特性</th><th>含义</th></tr></thead><tbody><tr><td>原子性（Atomicity）</td><td>事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。</td></tr><tr><td>一致性（Consistency）</td><td>事务前后数据的完整性必须保持一致</td></tr><tr><td>隔离性（Isolation）</td><td>是指多个用户并发访问数据库时，一个用户的事务不能被其它用户的事务所干扰，多个并发事务之间数据要相互隔离，不能相互影响。</td></tr><tr><td>持久性（Durability）</td><td>指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来即使数据库发生故障也不应该对其有任何影响</td></tr></tbody></table><h3><a name='header-c762' class='md-header-anchor '></a>3.5.2 事务的隔离级别</h3><p>事务在操作时的理想状态：多个事务之间互不影响，如果隔离级别设置不当就可能引发并发访问问题。</p><table><thead><tr><th>并发访问的问题</th><th>含义</th></tr></thead><tbody><tr><td>脏读</td><td>一个事务读取到了另一个事务中尚未提交的数据</td></tr><tr><td>不可重复读</td><td>一个事务中两次读取的数据内容不一致，要求的是一个事务中多次读取时数据是一致的，这是事务update时引发的问题</td></tr><tr><td>幻读</td><td>一个事务中两次读取的数据的数量不一致，要求在一个事务多次读取的数据的数量是一致的，这是insert或delete时引发的问题(很难演示出来)</td></tr></tbody></table><p>   <img src='imgs\事务58.png' alt='' />
   <img src='imgs\事务59.png' alt='' />
   <img src='imgs\事务60.png' alt='' /></p><p></p><p>MySQL数据库有四种隔离级别：上面的级别最低，下面的级别最高。“是”表示会出现这种问题，“否”表示不会出现这种问题。</p><table><thead><tr><th>级别</th><th>名字</th><th>隔离级别</th><th>脏读</th><th>不可重复读</th><th>幻读</th><th>数据库默认隔离级别</th></tr></thead><tbody><tr><td>1</td><td>读未提交</td><td>read uncommitted</td><td>是</td><td>是</td><td>是</td><td></td></tr><tr><td>2</td><td>读已提交</td><td>read committed</td><td>否</td><td>是</td><td>是</td><td>Oracle和SQL Server</td></tr><tr><td>3</td><td>可重复读</td><td>repeatable read</td><td>否</td><td>否</td><td>是</td><td>MySQL</td></tr><tr><td>4</td><td>串行化</td><td>serializable</td><td>否</td><td>否</td><td>否</td><td></td></tr></tbody></table><p><strong>MySQL事务隔离级别相关的命令</strong></p><ol><li><p>查询全局事务隔离级别</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">show variables <span class="cm-keyword">like</span> <span class="cm-string">'%isolation%'</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- 或</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> @@tx_isolation;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务27.png' alt='' /></p></li><li><p>设置事务隔离级别，需要退出MSQL再进入MYSQL才能看到隔离级别的变化</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> global transaction isolation level 级别字符串;（修改全局的，不建议）</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level 隔离级别;(修改当次)</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务28.png' alt='' /></p></li></ol><h4><a name='header-c842' class='md-header-anchor '></a>2.5.2.1 脏读的演示</h4><p>将数据进行恢复：<code>UPDATE account SET balance = 1000;</code></p><ol><li><p>打开A窗口登录MySQL，设置全局的隔离级别为最低</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">mysql -uroot -proot</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level read uncommitted;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务29.png' alt='' /></p></li><li><p>打开B窗口,AB窗口都开启事务</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">use day23;</span></pre><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务30.png' alt='' /></p></li><li><p>A窗口更新2个人的账户数据，未提交</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance-<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance+<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">2</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务31.png' alt='' /></p></li><li><p>B窗口查询账户</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务32.png' alt='' /></p></li><li><p>A窗口回滚</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">rollback;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务33.png' alt='' /></p></li><li><p>B窗口查询账户，钱没了
<img src='imgs\事务34.png' alt='' /></p></li></ol><p>脏读非常危险的，比如张三向李四购买商品，张三开启事务，向李四账号转入500块，然后打电话给李四说钱已经转了。李四一查询钱到账了，发货给张三。张三收到货后回滚事务，李四的再查看钱没了。</p><p><strong>解决脏读的问题</strong>：将全局的隔离级别进行提升
将数据进行恢复：<code>UPDATE account SET balance = 1000;</code></p><ol><li><p>在A窗口设置全局的隔离级别为<code>read committed</code></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level read committed;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务35.png' alt='' /></p></li><li><p>B窗口退出MySQL，B窗口再进入MySQL
<img src='imgs\事务36.png' alt='' /></p></li><li><p>AB窗口同时开启事务
<img src='imgs\事务37.png' alt='' /></p></li><li><p>A更新2个人的账户，未提交</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance-<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance+<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">2</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务38.png' alt='' /></p></li><li><p>B窗口查询账户
<img src='imgs\事务39.png' alt='' /></p></li><li><p>A窗口commit提交事务
<img src='imgs\事务40.png' alt='' /></p></li><li><p>B窗口查看账户
<img src='imgs\事务41.png' alt='' /></p></li></ol><blockquote><p>结论：read committed的方式可以避免脏读的发生</p></blockquote><p></p><h4><a name='header-c923' class='md-header-anchor '></a>2.5.2.2 不可重复读的演示</h4><p>将数据进行恢复：<code>UPDATE account SET balance = 1000;</code></p><ol><li><p>开启A窗口</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level read committed;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务42.png' alt='' /></p></li><li><p>开启B窗口，在B窗口开启事务</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务43.png' alt='' /></p></li><li><p>在A窗口开启事务，并更新数据</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance+<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">commit;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务44.png' alt='' /></p></li><li><p>B窗口查询</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务45.png' alt='' /></p></li></ol><p>两次查询输出的结果不同，到底哪次是对的？不知道以哪次为准。
很多人认为这种情况就对了，无须困惑，当然是后面的为准。我们可以考虑这样一种情况，比如银行程序需要将查询结果分别输出到电脑屏幕和发短信给客户，结果在一个事务中针对不同的输出目的地进行的两次查询不一致，导致文件和屏幕中的结果不一致，银行工作人员就不知道以哪个为准了。</p><p><strong>解决不可重复读的问题</strong>：将全局的隔离级别进行提升为：<code>repeatable read</code>
将数据进行恢复：<code>UPDATE account SET balance = 1000;</code></p><ol><li><p>A窗口设置隔离级别为：<code>repeatable read</code></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level repeatable read;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务46.png' alt='' /></p></li><li><p>B窗口退出MySQL，B窗口再进入MySQL</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务47.png' alt='' /></p></li><li><p>A窗口更新数据</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">update</span> account <span class="cm-keyword">set</span> balance=balance+<span class="cm-number">500</span> <span class="cm-keyword">where</span> id=<span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">commit;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务48.png' alt='' /></p></li><li><p>B窗口查询</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> * <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务49.png' alt='' /></p></li></ol><blockquote><p>结论：同一个事务中为了保证多次查询数据一致，必须使用<code>repeatable read</code>隔离级别
<img src='imgs\事务50.png' alt='' /></p></blockquote><p></p><h4><a name='header-c988' class='md-header-anchor '></a>2.5.2.3 幻读的演示</h4><p><strong>在MySQL中无法看到幻读的效果</strong>。但我们可以将事务隔离级别设置到最高，以挡住幻读的发生
将数据进行恢复：<code>UPDATE account SET balance = 1000;</code></p><ol><li><p>开启A窗口</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">set</span> session transaction isolation level serializable; <span class="cm-comment">-- 设置隔离级别为最高</span></span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务51.png' alt='' /></p></li><li><p>A窗口退出MySQL，A窗口重新登录MySQL</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-keyword">count</span>(*) <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务52.png' alt='' /></p></li><li><p>再开启B窗口，登录MySQL</p></li><li><p>在B窗口中开启事务，添加一条记录</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">start transaction; <span class="cm-comment">-- 开启事务</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">insert</span> <span class="cm-keyword">into</span> account (name,balance) <span class="cm-keyword">values</span> (<span class="cm-string">'LaoWang'</span>, <span class="cm-number">500</span>);</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务53.png' alt='' /></p></li><li><p>在A窗口中commit提交事务，B窗口中insert语句会在A窗口事务提交后立马运行
<img src='imgs\事务54.png' alt='' /></p></li><li><p>在A窗口中接着查询，发现数据不变</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">select</span> <span class="cm-keyword">count</span>(*) <span class="cm-keyword">from</span> account;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\事务55.png' alt='' /></p></li><li><p>B窗口中commit提交当前事务
<img src='imgs\事务56.png' alt='' /></p></li><li><p>A窗口就能看到最新的数据
<img src='imgs\事务57.png' alt='' /></p></li></ol><blockquote><p>结论：使用serializable隔离级别，一个事务没有执行完，其他事务的SQL执行不了，可以挡住幻读</p></blockquote><h1><a name='header-c1036' class='md-header-anchor '></a>第4章 DCL(了解)</h1><p>​	我们现在默认使用的都是root用户，超级管理员，拥有全部的权限。但是，一个公司里面的数据库服务器上面可能同时运行着很多个项目的数据库。所以，我们应该可以根据不同的项目建立不同的用户，分配不同的权限来管理和维护数据库。
   <img src='imgs\DCL01.png' alt='' /></p><h2><a name='header-c1038' class='md-header-anchor '></a>4.1 创建用户</h2><p><code>CREATE USER &#39;用户名&#39;@&#39;主机名&#39; IDENTIFIED BY &#39;密码&#39;;</code>
<strong>关键字说明：</strong></p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. `用户名`：将创建的用户名
  2. `主机名`：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%
  3. `密码`：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器</pre><p><strong>具体操作：</strong></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- user1用户只能在localhost这个IP登录mysql服务器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> USER <span class="cm-string">'user1'</span>@<span class="cm-string">'localhost'</span> IDENTIFIED <span class="cm-keyword">BY</span> <span class="cm-string">'123'</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">-- user2用户可以在任何电脑上登录mysql服务器</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">CREATE</span> USER <span class="cm-string">'user2'</span>@<span class="cm-string">'%'</span> IDENTIFIED <span class="cm-keyword">BY</span> <span class="cm-string">'123'</span>;</span></pre></div></div></div></div></div></div></div></pre><h2><a name='header-c1048' class='md-header-anchor '></a>4.2 授权用户</h2><p>用户创建之后，基本没什么权限！需要给用户授权
<img src='imgs\DCL02.png' alt='' /></p><p><strong>授权格式</strong>：
<code>GRANT 权限1, 权限2... ON 数据库名.表名 TO &#39;用户名&#39;@&#39;主机名&#39;;</code>
<strong>关键字说明</strong>：</p><pre class='md-fences mock-cm' style='display:block;position:relative'>  1. `GRANT` 授权关键字
  2. 授予用户的权限，如`SELECT`，`INSERT`，`UPDATE`等。如果要授予所的权限则使用`ALL`
  3. `数据库名.表名`：该用户可以操作哪个数据库的哪些表。如果要授予该用户对所有数据库和表的相应操作权限则可用*表示，如`*.*`
  4. `&#39;用户名&#39;@&#39;主机名&#39;`: 给哪个用户授权</pre><p><strong>具体操作：</strong></p><ol><li><p>给user1用户分配对test这个数据库操作的权限</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">GRANT <span class="cm-keyword">CREATE</span>,<span class="cm-keyword">ALTER</span>,<span class="cm-keyword">DROP</span>,<span class="cm-keyword">INSERT</span>,<span class="cm-keyword">UPDATE</span>,<span class="cm-keyword">DELETE</span>,<span class="cm-keyword">SELECT</span> <span class="cm-keyword">ON</span> test.* TO <span class="cm-string">'user1'</span>@<span class="cm-string">'localhost'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\DCL03.png' alt='' /></p></li><li><p>给user2用户分配对所有数据库操作的权限</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">GRANT ALL <span class="cm-keyword">ON</span> *.* TO <span class="cm-string">'user2'</span>@<span class="cm-string">'%'</span>;</span></pre></div></div></div></div></div></div></div></pre><p><img src='imgs\DCL04.png' alt='' /></p></li></ol><h2><a name='header-c1072' class='md-header-anchor '></a>4.3 撤销授权</h2><p><code>REVOKE  权限1, 权限2... ON 数据库.表名 FROM &#39;用户名&#39;@&#39;主机名&#39;;</code></p><p><strong>具体操作：</strong></p><ul><li><p>撤销user1用户对test操作的权限</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> REVOKE ALL <span class="cm-keyword">ON</span> test.* <span class="cm-keyword">FROM</span> <span class="cm-string">'user1'</span>@<span class="cm-string">'localhost'</span>;</span></pre></div></div></div></div></div></div></div></pre><p> <img src='imgs\DCL05.png' alt='' /></p></li></ul><h2><a name='header-c1084' class='md-header-anchor '></a>4.4 查看权限</h2><p><code>SHOW GRANTS FOR &#39;用户名&#39;@&#39;主机名&#39;;</code>
<strong>具体操作：</strong></p><ul><li><p>查看user1用户的权限</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"> SHOW GRANTS FOR <span class="cm-string">'user1'</span>@<span class="cm-string">'localhost'</span>;</span></pre></div></div></div></div></div></div></div></pre><p> <img src='imgs\DCL06.png' alt='' /></p></li></ul><h2><a name='header-c1095' class='md-header-anchor '></a>4.5 删除用户</h2><p><code>DROP USER &#39;用户名&#39;@&#39;主机名&#39;;</code>
<strong>具体操作：</strong></p><ul><li><p>删除user2</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">DROP</span> USER <span class="cm-string">'user2'</span>@<span class="cm-string">'%'</span>;</span></pre></div></div></div></div></div></div></div></pre><p> <img src='imgs\DCL07.png' alt='' /></p></li></ul><h2><a name='header-c1106' class='md-header-anchor '></a>4.6 修改用户密码</h2><h3><a name='header-c1107' class='md-header-anchor '></a>4.6.1 修改管理员密码</h3><p><code>mysqladmin -uroot -p password 新密码  -- 新密码不需要加上引号</code></p><blockquote><p>注意：需要在未登陆MySQL的情况下操作。</p></blockquote><p><strong>具体操作：</strong></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">mysqladmin -uroot -p password <span class="cm-number">123456</span></span></pre><pre class=""><span style="padding-right: 0.1px;">输入老密码</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\DCL08.png' alt='' /></p><h3><a name='header-c1118' class='md-header-anchor '></a>4.6.2 修改普通用户密码</h3><p><code>set password for &#39;用户名&#39;@&#39;主机名&#39; = password(&#39;新密码&#39;);</code></p><blockquote><p>注意：需要在登陆MySQL的情况下操作。</p></blockquote><p><strong>具体操作：</strong></p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">`set password for <span class="cm-string">'user1'</span>@<span class="cm-string">'localhost'</span> = password(<span class="cm-string">'666666'</span>);`</span></pre></div></div></div></div></div></div></div></pre><p>   <img src='imgs\DCL09.png' alt='' /></p></div>
</body>
</html>